{% load static %}
{% load i18n %}

<!DOCTYPE html>
<html>
    <head>
        <title>
            {% trans "HSFE - gStock" %}
        </title>

        <link href="{% static 'gStock/css/googleapis/roboto_familly.css' %}" rel="stylesheet">
        <link href="{% static 'gStock/css/mdi/materialdesignicons.min.css' %}" rel="stylesheet">
        <link href="{% static 'gStock/css/vuetify/vuetify.min.css' %}" rel="stylesheet">

        {% comment %} <link href="https://cdn.jsdelivr.net/npm/@mdi/font@5.x/css/materialdesignicons.min.css" rel="stylesheet">  {% endcomment %}

        {% comment %} <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900" rel="stylesheet">
        <link href="https://cdn.jsdelivr.net/npm/@mdi/font@5.x/css/materialdesignicons.min.css" rel="stylesheet">
        <link href="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.min.css" rel="stylesheet"> {% endcomment %}

        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">
    </head>
    <style>
        .bgColor {
            background-color: #efebe9;
        }
        .hr_style {
            border: none;
            opacity: 0.35;
            height: 1px;
            color: #A1887F;
            background-color: #A1887F;
        }
        a {
            text-decoration: none;
        }

        .v-progress-circular {
            margin: 1rem;
        }

        .parent_center{
            height: 100%;
            position: absolute;
            width: 100%;
            top: 0;
            left: 0;
        }
        .child_center{
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            transform: translateY(-50%);
        }
        .drawer{
          background-color: #01579b!important;
          border: solid 1px white;
        }
        /* table, th, td {
          border: 1px solid grey;
        } */


        .invoice-box {
          max-width: 900px;
          margin: auto;
          padding: 30px;
          border: 1px solid #eee;
          box-shadow: 0 0 10px rgba(0, 0, 0, 0.15);
          font-size: 16px;
          line-height: 24px;
          font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif;
          color: #555;
        }

        .invoice-box table {
          width: 100%;
          line-height: inherit;
          text-align: left;
          border: 1px solid grey;
        }

        .invoice-box table td {
          padding: 5px;
          vertical-align: top;
          border: 1px solid grey;
        }

        .invoice-box table tr td:nth-child(n + 2) {
          text-align: right;
        }

        .invoice-box table tr.top table td {
          padding-bottom: 20px;
        }

        .invoice-box table tr.top table td.title {
          font-size: 45px;
          line-height: 45px;
          color: #333;
        }

        .invoice-box table tr.information table td {
          padding-bottom: 40px;
        }

        .invoice-box table tr.heading td {
          background: #e0e0e0;
          border-bottom: 1px solid #ddd;
          font-weight: bold;
        }

        .invoice-box table tr.details td {
          padding-bottom: 20px;
        }

        .invoice-box table tr.item td {
          border-bottom: 1px solid #eee;
        }

        .invoice-box table tr.item.last td {
          border-bottom: none;
        }

        .invoice-box table tr.item input {
          padding-left: 5px;
        }

        .invoice-box table tr.item td:first-child input {
          margin-left: -5px;
          width: 100%;
        }

        .invoice-box table tr.total td:nth-child(2) {
          border-top: 2px solid #eee;
          font-weight: bold;
          background: red;
          color: white;
        }

        .invoice-box input[type="number"] {
          width: 100px;
        }

        #quantity_input {
          width: 60px;
        }

        @media only screen and (max-width: 600px) {
          .invoice-box table tr.top table td {
            width: 100%;
            display: block;
            text-align: center;
          }

          .invoice-box table tr.information table td {
            width: 100%;
            display: block;
            text-align: center;
          }
        }


        .rtl {
          direction: rtl;
          font-family: Tahoma, "Helvetica Neue", "Helvetica", Helvetica, Arial,
            sans-serif;
        }

        .rtl table {
          text-align: right;
        }

        .rtl table tr td:nth-child(2) {
          text-align: left;
        }
    </style>

    <body onload="date_time('realtime_date', 'realtime_time')">
        <div id="app">
            <template>
              <!-- Before Login  -->
                <v-app v-if="isLogged === false" id="inspire">
                    <v-app-bar
                        app
                        color="light-blue darken-4"
                        dark
                    >
                        <v-toolbar-title>
                            gStock
                        </v-toolbar-title>

                        <v-spacer></v-spacer>

                        <v-divider
                            class="mx-4 primary"
                            vertical
                        ></v-divider>

                        <v-toolbar-title
                            color="white"
                            class="text-center"
                        >
                            <span class="font-weight-thin">
                                <span id="realtime_date"></span>
                            </span>

                            <br>
                            <span class="font-weight-thin">
                                <span id="realtime_time"></span>
                            </span>
                        </v-toolbar-title>
                    </v-app-bar>

                    <v-main class="bgColor">
                        <v-container fluid fill-height>
                           <v-layout align-center justify-center>
                              <v-flex xs12 sm8 md4>
                                 <v-card class="elevation-12">
                                    <v-toolbar dark color="primary">
                                       <v-toolbar-title>Connexion</v-toolbar-title>
                                    </v-toolbar>
                                    <v-card-text>
                                       <h2 v-if="wrongCred">Wrong credentials entered!. Please enter your correct details.</h2>
                                       <v-form>
                                          <v-text-field
                                             v-model="username"
                                             prepend-icon="mdi-account"
                                             name="username"
                                             label="Username"
                                             type="text"
                                          ></v-text-field>
                                          <v-text-field
                                             v-model="password"
                                             id="password"
                                             prepend-icon="mdi-lock"
                                             name="password"
                                             label="Password"
                                             type="password"
                                          ></v-text-field>
                                       </v-form>
                                    </v-card-text>
                                    <v-card-actions>
                                       <v-spacer></v-spacer>
                                       <v-btn
                                          color="primary"
                                          @click="loginUser"
                                        >
                                            Login
                                        </v-btn>
                                    </v-card-actions>
                                 </v-card>
                              </v-flex>
                           </v-layout>
                        </v-container>
                    </v-main>

                    <v-footer
                        color="light-blue darken-4"
                        height="50"
                        class="font-weight-thin"
                        app
                    >
                        <p class="text-left white--text">
                          Copyright &copy;[[ new Date().getFullYear() ]]
                          <span class="font-weight-light"> HAL Solutions For Efficiency</span>.
                          Tous Droits Réservés

                          |

                          <a
                            href="{% url 'index' %}"
                            class="yellow--text font-weight-light gotowebsite"
                            onmouseover="this.style.textDecoration='underline';"
                            onmouseout="this.style.textDecoration='none';"
                          > Go to website </a>
                      </p>
                    </v-footer>
                </v-app>

                <!-- After login -->

                <v-app v-else id="inspire">
                    <v-navigation-drawer
                        v-model="drawer"
                        app
                        color="brown lighten-5"
                    >
                        <div
                          class="elevation-2"
                          style="background-color:white!important;"
                        >
                          <a
                              href="{% url 'index_gstock' %}"
                          >
                            <v-img
                              height="100"
                              width="100"
                              src="{% static 'gStock/img/HSFE_BRAND.png' %}"
                              style="margin-top: 0px; margin-left: 80px; margin-right: 80px;"
                            ></v-img>
                          </a>
                        </div>

                        <hr class="hr_style">

                          <v-list dense>
                            <v-list-item-group
                              v-model="selectedItem"
                              color="primary"
                            >
                              <v-list-item
                                v-for="(item, i) in items"
                                :key="i"
                                :to="item.href"
                                class="elevation-2"
                              >
                                <v-list-item-icon>
                                  <v-icon v-text="item.icon"></v-icon>
                                </v-list-item-icon>
                                <hr class="hr_style">
                                <v-list-item-content>
                                  <v-list-item-title v-text="item.text"></v-list-item-title>
                                </v-list-item-content>
                              </v-list-item>
                            </v-list-item-group>
                          </v-list>

                    </v-navigation-drawer>

                    <v-app-bar
                        app
                        color="light-blue darken-4"
                        dark
                    >
                        <v-app-bar-nav-icon color='white' elevation="20" class='drawer' var @click.stop="drawer = !drawer"></v-app-bar-nav-icon>
                        <v-toolbar-title>
                            <a
                                href="{% url 'index_gstock' %}"
                                class="white--text"
                            >
                               gStock
                            </a>
                            <!-- {% if perms.auth.delete_user %}
                            ok
                            {% endif %} -->
                        </v-toolbar-title>

                        <v-spacer></v-spacer>
                        <v-divider
                            class="mx-4 primary"
                            vertical
                        ></v-divider>
                          <span title="Utilisateur connecté">[[ current_username ]] | </span>
                          <v-btn
                             fab
                             dark
                             small
                             title="déconnexion"
                             color="#01579b"
                             href="{% url 'logout' %}"
                           >
                               <v-icon
                                 small
                                 color='white'
                                 @click="logout"
                               >
                                 mdi-logout
                               </v-icon>
                           </v-btn>
                        <v-divider
                            class="mx-4 primary"
                            vertical
                        ></v-divider>

                        <v-toolbar-title
                            color="white"
                            class="text-center"
                        >
                            <span class="font-weight-thin">
                                <span id="realtime_date"></span>
                            </span>

                            <br>
                            <span class="font-weight-thin">
                                <span id="realtime_time"></span>
                            </span>
                        </v-toolbar-title>
                    </v-app-bar>

                    <v-btn
                        v-scroll="onScroll"
                        v-show="fab"
                        fab
                        dark
                        fixed
                        bottom
                        right
                        color="primary"
                        @click="toTop"
                    >
                        <v-icon>mdi-chevron-up</v-icon>
                    </v-btn>

                    <v-main class="bgColor">
                        <v-container fluid >
                            <!-- Main content here via components-->
                            <keep-alive>
                                <router-view></router-view>
                            </keep-alive>
                        </v-container>
                    </v-main>

                    <v-footer
                        color="light-blue darken-4"
                        height="50"
                        class="font-weight-thin"
                        app
                    >
                        <p class="text-left white--text">
                          Copyright &copy;[[ new Date().getFullYear() ]]
                          <span class="font-weight-light"> HAL Solutions For Efficiency</span>.
                          Tous Droits Réservés

                          |

                          <a
                            href="{% url 'index' %}"
                            class="yellow--text font-weight-light gotowebsite"
                            onmouseover="this.style.textDecoration='underline';"
                            onmouseout="this.style.textDecoration='none';"
                          > Go to website </a>
                      </p>
                    </v-footer>
                </v-app>
            </template>
        </div>


        {% comment %} <script src="{% static 'gStock/js/vuejs/vuex.min.js' %}"></script>
        <script src="{% static 'gStock/js/vuejs/vue-router.min.js' %}"></script>
        <script src="{% static 'gStock/js/vuejs/vue.min.js' %}"></script>

        <script src="{% static 'gStock/js/axios/axios.min.js' %}"></script>
        <script src="{% static 'gStock/js/vuetify/vuetify.min.js' %}"></script> {% endcomment %}


        <script src="https://cdn.jsdelivr.net/npm/vuex@2.x/dist/vuex.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/vue-router@2.x/dist/vue-router.min.js"></script>

        <script src="https://cdn.jsdelivr.net/npm/vue@2.x/dist/vue.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.min.js"></script>

        <script src="https://unpkg.com/vuex-persistedstate/dist/vuex-persistedstate.umd.js"></script>



        <!-- Vue templates -->
        <template id="dashboard-template">
            <div class="container">
              <v-row align="center">
                <v-item-group
                  v-model="window"
                  class="shrink mr-6"
                  mandatory
                  tag="v-flex"
                >
                  <v-item
                    v-for="n in length"
                    :key="n"
                    v-slot="{ active, toggle }"
                  >
                    <div>
                      <v-btn
                        :input-value="active"
                        icon
                        @click="toggle"
                      >
                        <v-icon>mdi-record</v-icon>
                      </v-btn>
                    </div>
                  </v-item>
                </v-item-group>

                <v-col>
                  <v-window
                    v-model="window"
                    class="elevation-1"
                    vertical
                  >
                    <v-window-item
                      v-for="n in length"
                      :key="n"
                    >
                      <v-card
                        v-if="n===1"
                        flat
                      >
                        <v-card-text>
                          <v-row>
                              <v-col
                                  cols="12"
                                  sm="12"
                                  md="4"
                              >
                                <v-card
                                  height="200"
                                  elevation="5"
                                  ripple="true"
                                  color="deep-purple lighten-2"
                                  to="/gstock/stocks/"
                                >
                                  <v-card-text class="text-center">
                                    <span>
                                      <br><br><br>
                                      <span v-if="articles.length<=9999" class="white--text" style="font-size:75px!important; font-weight:bold; text-align:center;">
                                        [[ articles.length ]]
                                      </span>
                                      <span v-if="articles.length>9999" class="white--text" style="font-size:75px!important; font-weight:bold; text-align:center;">
                                        +999
                                      </span>
                                      <span v-if="typeof articles.length === 'undefined'" class="red--text" style="font-size:30px!important; font-weight:bold; text-align:center;">
                                        ! Accès refusé !
                                      </span>
                                      <br>
                                      <br>
                                      <span class="white--text" style="font-size:30px!important; font-weight:bold; text-align:center;">
                                        Articles
                                      </span>
                                    </span>
                                  </v-card-text>
                                </v-card>
                              </v-col>
                              <v-col
                                  cols="12"
                                  sm="12"
                                  md="4"
                              >
                                <v-card
                                  height="200"
                                  elevation="5"
                                  ripple="true"
                                  color="blue-grey lighten-2"
                                  to="/gstock/produits/"
                                >
                                  <v-card-text class="text-center">
                                    <span>
                                      <br><br><br>
                                      <span v-if="produits.length<=9999" class="white--text" style="font-size:75px!important; font-weight:bold; text-align:center;">
                                        [[ produits.length ]]
                                      </span>
                                      <span v-if="produits.length>9999" class="white--text" style="font-size:75px!important; font-weight:bold; text-align:center;">
                                        +999
                                      </span>
                                      <span v-if="typeof produits.length === 'undefined'" class="red--text" style="font-size:30px!important; font-weight:bold; text-align:center;">
                                        ! Accès refusé !
                                      </span>
                                      <br>
                                      <br>
                                      <span class="white--text" style="font-size:30px!important; font-weight:bold; text-align:center;">
                                        Produits
                                      </span>
                                    </span>
                                  </v-card-text>
                                </v-card>
                              </v-col>
                              <v-col
                                  cols="12"
                                  sm="12"
                                  md="4"
                              >
                                <v-card
                                  height="200"
                                  elevation="5"
                                  ripple="true"
                                  color="blue lighten-2"
                                  to="/gstock/materiels/"
                                >
                                  <v-card-text class="text-center">
                                    <span>
                                      <br><br><br>
                                      <span v-if="materiels.length<=9999" class="white--text" style="font-size:75px!important; font-weight:bold; text-align:center;">
                                        [[ materiels.length ]]
                                      </span>
                                      <span v-if="materiels.length>9999" class="white--text" style="font-size:75px!important; font-weight:bold; text-align:center;">
                                        +999
                                      </span>
                                      <span v-if="typeof materiels.length === 'undefined'" class="red--text" style="font-size:30px!important; font-weight:bold; text-align:center;">
                                        ! Accès refusé !
                                      </span>
                                      <br>
                                      <br>
                                      <span class="white--text" style="font-size:30px!important; font-weight:bold; text-align:center;">
                                        Materiels
                                      </span>
                                    </span>
                                  </v-card-text>
                                </v-card>
                              </v-col>
                          </v-row>
                          <v-row>
                              <v-col
                                  cols="12"
                                  sm="12"
                                  md="4"
                              >
                                <v-card
                                  height="200"
                                  elevation="5"
                                  ripple="true"
                                  color="indigo lighten-1"
                                  to="/gstock/sorties/"
                                >
                                  <v-card-text class="text-center">
                                    <span>
                                      <br><br><br>
                                      <span v-if="sorties.length<=9999" class="white--text" style="font-size:75px!important; font-weight:bold; text-align:center;">
                                        [[ sorties.length ]]
                                      </span>
                                      <span v-if="sorties.length>9999" class="white--text" style="font-size:75px!important; font-weight:bold; text-align:center;">
                                        +999
                                      </span>
                                      <span v-if="typeof sorties.length === 'undefined'" class="red--text" style="font-size:30px!important; font-weight:bold; text-align:center;">
                                        ! Accès refusé !
                                      </span>
                                      <br>
                                      <br>
                                      <span class="white--text" style="font-size:30px!important; font-weight:bold; text-align:center;">
                                        Sorties Stock
                                      </span>
                                    </span>
                                  </v-card-text>
                                </v-card>
                              </v-col>
                              <v-col
                                  cols="12"
                                  sm="12"
                                  md="4"
                              >
                                <v-card
                                  height="200"
                                  elevation="5"
                                  ripple="true"
                                  color="teal darken-2"
                                  to="/gstock/entrees/"
                                >
                                  <v-card-text class="text-center">
                                    <span>
                                      <br><br><br>
                                      <span v-if="entrees.length<=9999" class="white--text" style="font-size:75px!important; font-weight:bold; text-align:center;">
                                        [[ entrees.length ]]
                                      </span>
                                      <span v-if="entrees.length>9999" class="white--text" style="font-size:75px!important; font-weight:bold; text-align:center;">
                                        +999
                                      </span>
                                      <span v-if="typeof entrees.length === 'undefined'" class="red--text" style="font-size:30px!important; font-weight:bold; text-align:center;">
                                        ! Accès refusé !
                                      </span>
                                      <br>
                                      <br>
                                      <span class="white--text" style="font-size:30px!important; font-weight:bold; text-align:center;">
                                        Entrées Stock
                                      </span>
                                    </span>
                                  </v-card-text>
                                </v-card>
                              </v-col>
                              <v-col
                                  cols="12"
                                  sm="12"
                                  md="4"
                              >
                                <v-card
                                  height="200"
                                  elevation="5"
                                  ripple="true"
                                  color="light-blue darken-2"
                                  to="/gstock/#"
                                >
                                  <v-card-text class="text-center">
                                    <span>
                                      <br><br><br>
                                      <span class="white--text" style="font-size:75px!important; font-weight:bold; text-align:center;">
                                        <!-- [[ materiels.length ]] -->
                                      </span>
                                      <br>
                                      <br>
                                      <span class="white--text" style="font-size:30px!important; font-weight:bold; text-align:center;">
                                        <!-- Materiels -->
                                      </span>
                                    </span>
                                  </v-card-text>
                                </v-card>
                              </v-col>
                          </v-row>
                        </v-card-text>
                      </v-card>

                      <!-- <v-card
                        v-if="n===2"
                        flat
                      >
                        <v-card-title>
                          <h1>
                            Notifications
                          </h1>
                        </v-card-title>
                        <hr class="hr_style">
                        <v-card-text>
                          <v-row
                            v-if="alerts_sorties.length != 0 || alerts_entrees.length != 0"
                          >
                            <v-col
                                cols="12"
                                sm="12"
                                md="12"
                            >
                              <v-list
                                v-if="alerts_sorties"
                              >
                                <v-list-group
                                  :value="false"
                                >
                                  <template v-slot:activator>
                                    <v-list-item-title>Sorties</v-list-item-title>
                                  </template>

                                    <v-list-item
                                      v-for="(sortie, i) in alerts_sorties"
                                      :key="i"
                                      link
                                    >
                                      <v-list-item-title v-text="sortie.reference"></v-list-item-title>

                                      <v-spacer></v-spacer>

                                      <v-dialog
                                        v-model="dialogViewSortie"
                                        max-width="600px"
                                      >
                                        <template v-slot:activator="{ on, attrs }">
                                          <v-icon
                                            small
                                            class="mr-2"
                                            v-bind="attrs"
                                            v-on="on"
                                            @click="sortieDetailView(sortie.reference)"
                                          >
                                            mdi-eye
                                          </v-icon>
                                        </template>
                                        <v-card>
                                          <v-card-title>
                                            <span class="headline">Detail sortie : <span class="font-weight-medium text-decoration-underline">[[ sortieDetail.reference ]]</span></span>
                                          </v-card-title>

                                          <v-card-text>
                                            <v-container>
                                              <v-simple-table dense>
                                                <template v-slot:default>
                                                  <thead>
                                                    <tr>
                                                      <th class="text-left"></th>
                                                      <th class="text-left"></th>
                                                    </tr>
                                                  </thead>
                                                  <tbody>
                                                    <tr>
                                                      <td>Référence</td>
                                                      <td class="font-weight-medium">[[ sortieDetail.reference ]]</td>
                                                    </tr>
                                                    <tr>
                                                      <td>Articles</td>
                                                      <td class="font-weight-medium">
                                                        <v-expansion-panels
                                                          focusable
                                                        >
                                                          <v-expansion-panel>
                                                            <v-expansion-panel-header
                                                              expand-icon="mdi-menu-down"
                                                              color="#CFE5E2"
                                                              class="font-weight-medium"
                                                            >
                                                              <span color="white">Articles Sortis</span>
                                                            </v-expansion-panel-header>
                                                            <v-expansion-panel-content color="#E4F0EE">
                                                              <p
                                                                v-for="(d, index) in getDATA"
                                                                :key="index"
                                                              >
                                                                <span>
                                                                  - [[ d.name ]] : [[ d.quantity ]]
                                                                  <span class="font-weight-medium red--text">[[ d.unit ]] (s)</span>
                                                                </span>
                                                              </p>
                                                            </v-expansion-panel-content>
                                                          </v-expansion-panel>
                                                        </v-expansion-panels>
                                                      </td>
                                                    </tr>
                                                    <tr>
                                                      <td>Motif</td>
                                                      <td class="font-weight-medium">[[ sortieDetail.motif ]]</td>
                                                    </tr>
                                                    <tr>
                                                      <td>Date</td>
                                                      <td class="font-weight-medium">[[ sortieDetail.date ]]</td>
                                                    </tr>
                                                    <tr>
                                                      <td></td>
                                                      <td class="font-weight-medium"></td>
                                                    </tr>
                                                  </tbody>
                                                </template>
                                              </v-simple-table>
                                            </v-container>
                                          </v-card-text>

                                          <v-card-actions>
                                            <v-spacer></v-spacer>
                                            <v-btn
                                              color="blue darken-1"
                                              text
                                              @click="closeViewSortie"
                                            >
                                              Fermer
                                            </v-btn>
                                          </v-card-actions>
                                        </v-card>
                                      </v-dialog>
                                    </v-list-item>
                                </v-list-group>
                              </v-list>
                              <v-list
                                v-if="alerts_entrees"
                              >
                                <v-list-group
                                  :value="false"
                                >
                                  <template v-slot:activator>
                                    <v-list-item-title>Entrées</v-list-item-title>
                                  </template>

                                    <v-list-item
                                      v-for="(entree, i) in alerts_entrees"
                                      :key="i"
                                      link
                                    >
                                      <v-list-item-title v-text="entree.reference"></v-list-item-title>

                                      <v-spacer></v-spacer>

                                      <v-dialog
                                        v-model="dialogViewEntree"
                                        max-width="600px"
                                      >
                                        <template v-slot:activator="{ on, attrs }">
                                          <v-icon
                                            small
                                            class="mr-2"
                                            v-bind="attrs"
                                            v-on="on"
                                            @click="entreeDetailView(entree.reference)"
                                          >
                                            mdi-eye
                                          </v-icon>
                                        </template>
                                        <v-card>
                                          <v-card-title>
                                            <span class="headline">Detail sortie : <span class="font-weight-medium text-decoration-underline">[[ entreeDetail.reference ]]</span></span>
                                          </v-card-title>

                                          <v-card-text>
                                            <v-container>
                                              <v-simple-table dense>
                                                <template v-slot:default>
                                                  <thead>
                                                    <tr>
                                                      <th class="text-left"></th>
                                                      <th class="text-left"></th>
                                                    </tr>
                                                  </thead>
                                                  <tbody>
                                                    <tr>
                                                      <td>Référence</td>
                                                      <td class="font-weight-medium">[[ entreeDetail.reference ]]</td>
                                                    </tr>
                                                    <tr>
                                                      <td>Articles</td>
                                                      <td class="font-weight-medium">
                                                        <v-expansion-panels
                                                          focusable
                                                        >
                                                          <v-expansion-panel>
                                                            <v-expansion-panel-header
                                                              expand-icon="mdi-menu-down"
                                                              color="#CFE5E2"
                                                              class="font-weight-medium"
                                                            >
                                                              <span color="white">Articles Entrés</span>
                                                            </v-expansion-panel-header>
                                                            <v-expansion-panel-content color="#E4F0EE">
                                                              <p
                                                                v-for="(d, index) in getDATA"
                                                                :key="index"
                                                              >
                                                                <span>
                                                                  - [[ d.name ]] : [[ d.quantity ]]
                                                                  <span class="font-weight-medium red--text">[[ d.unit ]] (s)</span>
                                                                </span>
                                                              </p>
                                                            </v-expansion-panel-content>
                                                          </v-expansion-panel>
                                                        </v-expansion-panels>
                                                      </td>
                                                    </tr>
                                                    <tr>
                                                      <td>Date</td>
                                                      <td class="font-weight-medium">[[ entreeDetail.date ]]</td>
                                                    </tr>
                                                    <tr>
                                                      <td></td>
                                                      <td class="font-weight-medium"></td>
                                                    </tr>
                                                  </tbody>
                                                </template>
                                              </v-simple-table>
                                            </v-container>
                                          </v-card-text>

                                          <v-card-actions>
                                            <v-spacer></v-spacer>
                                            <v-btn
                                              color="blue darken-1"
                                              text
                                              @click="closeViewEntree"
                                            >
                                              Fermer
                                            </v-btn>
                                          </v-card-actions>
                                        </v-card>
                                      </v-dialog>
                                    </v-list-item>
                                </v-list-group>
                              </v-list>
                            </v-col>
                          </v-row>
                          <v-row
                            v-else
                          >
                              <v-col
                                  cols="12"
                                  sm="12"
                                  md="4"
                              >
                                Aucune notification
                              </v-col>
                          </v-row>
                        </v-card-text>
                      </v-card> -->

                      <v-card v-if="n===2" flat>
                        <v-card-title>
                          <h1>
                            Configurations
                          </h1>
                        </v-card-title>
                        <hr class="hr_style">
                        <v-card-text>
                          <v-row>
                            <v-col
                                cols="12"
                                sm="12"
                                md="12"
                            >
                              <h2>
                                Utilisateur Connecté(e):
                              </h2>
                              <v-simple-table
                                dense
                              >
                                <template v-slot:default>
                                  <thead>
                                    <tr>
                                      <th class="text-left"></th>
                                      <th class="text-left"></th>
                                    </tr>
                                  </thead>
                                  <tbody>
                                    <tr>
                                      <td>Username</td>
                                      <td class="font-weight-medium green">[[ connected_user.username ]]</td>
                                    </tr>
                                    <tr>
                                      <td>Nom</td>
                                      <td class="font-weight-medium">[[ connected_user.last_name ]]</td>
                                    </tr>
                                    <tr>
                                      <td>Prénom</td>
                                      <td class="font-weight-medium">[[ connected_user.first_name ]]</td>
                                    </tr>
                                    <tr>
                                      <td>E-mail</td>
                                      <td class="font-weight-medium">[[ connected_user.email ]]</td>
                                    </tr>
                                    <tr>
                                      <td>Accreditation Level</td>
                                      <td class="font-weight-medium">
                                        <span v-if="connected_user.is_superuser===true">Administrateur</span>
                                        <span v-else>Utilisateur</span>
                                      </td>
                                    </tr>
                                    <tr>
                                      <td>Date création</td>
                                      <td class="font-weight-medium">[[ connected_user.date_joined ]]</td>
                                    </tr>
                                  </tbody>
                                </template>
                              </v-simple-table>
                              <hr class="hr_style">
                            </v-col>
                          </v-row>
                        </v-card-text>

                        <hr class="hr_style">

                        <v-card-text>
                          <span class="white--text light-blue darken-2 font-weight-light">gStock : v2.0.1 - mai 2021</span>
                        </v-card-text>
                      </v-card>
                    </v-window-item>
                  </v-window>

                  <template>
                    <div class="text-center ma-2">
                      <v-snackbar
                        v-model="error_snackbar"
                        color="error"
                      >
                        <span class="white--text">[[ error_message ]]</span>

                        <template v-slot:action="{ attrs }">
                          <v-btn
                            color="white"
                            text
                            v-bind="attrs"
                            @click="error_snackbar = false"
                          >
                            Close
                          </v-btn>
                        </template>
                      </v-snackbar>
                    </div>
                  </template>
                </v-col>
              </v-row>
            </div>
        </template>

        <template id="articles-template">
          <div class="container-fluid">
            <v-data-table
              :headers="headers"
              :items="produits"
              :search="search"
              sort-by="name"
              class="elevation-1"
            >
              <template v-slot:item.article="{ item }">
                <span
                  v-for="(article, index) in articles"
                  :key="index"
                  class="font-weight-medium"
                >
                  <span v-if="article.id===item.article">[[ article.name ]]</span>
                </span>
              </template>
              <template v-slot:item.supplier="{ item }">
                <span
                  v-for="(supplier, index) in suppliers"
                  :key="index"
                >
                  <span v-if="supplier.id===item.supplier">[[ supplier.name ]]</span>
                </span>
              </template>
              <template v-slot:item.stock="{ item }">
                <span
                  v-for="(article, index) in articles"
                  :key="index"
                  class="font-weight-medium"
                >
                  <span v-if="article.id===item.article">
                    <v-chip
                      :color="getColor(article.stock, article.threshold)"
                      dark
                    >
                      [[ article.stock ]]
                    </v-chip>
                  </span>
                </span>
              </template>
              <template v-slot:item.unit="{ item }">
                <span
                  v-for="(article, index) in articles"
                  :key="index"
                  class="font-weight-medium"
                >
                  <span v-if="article.id===item.article">
                    <span
                      v-for="(unit, index) in units"
                      :key="index"
                      class="font-weight-medium"
                    >
                      <span v-if="unit.id===article.unit">[[ unit.name ]](s)</span>
                    </span>
                  </span>
                </span>
              </template>

              <template v-slot:top>
                <v-toolbar
                  flat
                >
                  <v-toolbar-title><h5 class="text-center">[[ produits.length ]]</h5>Produits</v-toolbar-title>
                  <v-divider
                    class="mx-4"
                    inset
                    vertical
                  ></v-divider>
                  <v-spacer></v-spacer>
                  <v-spacer></v-spacer>

                  <v-dialog
                    v-model="dialog"
                    max-width="500px"
                  >
                    <template v-slot:activator="{ on, attrs }">
                      <v-icon
                        color="primary"
                        dark
                        x-large
                        class="mb-2"
                        v-bind="attrs"
                        v-on="on"
                      >
                        mdi-plus-circle
                      </v-icon>
                    </template>
                    <v-card>
                      <v-card-title>
                        <span class="headline">[[ formTitle ]]</span>
                      </v-card-title>

                      <v-card-text>
                        <v-container>
                          <v-row>
                            <v-col
                              cols="12"
                              sm="6"
                              md="6"
                            >
                              <v-autocomplete
                                v-model="editedItem.article"
                                :items="articles"
                                item-text="name"
                                item-value="id"
                                color="primary"
                                label="Article"
                              ></v-autocomplete>
                            </v-col>
                            <v-col
                              cols="12"
                              sm="6"
                              md="6"
                            >
                              <v-text-field
                                v-model="editedItem.buying_price"
                                type="number"
                                min="0"
                                label="Prix Achat"
                              ></v-text-field>
                            </v-col>
                            <v-col
                              cols="12"
                              sm="6"
                              md="4"
                            >
                            <v-text-field
                              v-model="editedItem.selling_price"
                              type="number"
                              min="0"
                              label="Prix Vente"
                            ></v-text-field>
                            </v-col>
                            <v-col
                              cols="12"
                              sm="6"
                              md="4"
                            >
                            <v-autocomplete
                              v-model="editedItem.supplier"
                              :items="suppliers"
                              item-text="name"
                              item-value="id"
                              color="primary"
                              label="Fournisseur"
                            ></v-autocomplete>
                            </v-col>
                          </v-row>
                        </v-container>
                      </v-card-text>

                      <v-card-actions>
                        <v-spacer></v-spacer>
                        <v-btn
                          color="blue darken-1"
                          text
                          @click="close"
                        >
                          Annuler
                        </v-btn>
                        <v-btn
                          color="blue darken-1"
                          text
                          @click="save_produit"
                        >
                          Enregistrer
                        </v-btn>
                      </v-card-actions>
                    </v-card>
                  </v-dialog>

                  <v-spacer></v-spacer>
                  <v-text-field
                    v-model="search"
                    append-icon="mdi-magnify"
                    label="Rechercher"
                    single-line
                    hide-details
                    clearable
                  ></v-text-field>
                </v-toolbar>
              </template>
              <template v-slot:item.actions="{ item }">
                <!-- <v-dialog
                  v-model="dialogViewArticle"
                  max-width="600px"
                >
                  <template v-slot:activator="{ on, attrs }">
                    <v-icon
                      small
                      class="mr-2"
                      v-bind="attrs"
                      v-on="on"
                      @click="articleDetailView(item.article)"
                    >
                      mdi-eye
                    </v-icon>
                  </template>
                  <v-card>
                    <v-card-title>
                      <span class="headline">Detail produit : <span class="font-weight-medium text-decoration-underline">[[ articleDetail.name ]]</span></span>
                    </v-card-title>

                    <v-card-text>
                      <v-container>
                        <v-simple-table dense>
                          <template v-slot:default>
                            <thead>
                              <tr>
                                <th class="text-left">

                                </th>
                                <th class="text-left">

                                </th>
                              </tr>
                            </thead>
                            <tbody>
                              <tr>
                                <td>Nom</td>
                                <td class="font-weight-medium">[[ articleDetail.name ]]</td>
                              </tr>
                              <tr>
                                <td>Modèle</td>
                                <td class="font-weight-medium">[[ articleDetail.articleModel ]]</td>
                              </tr>
                              <tr>
                                <td>Référence</td>
                                <td class="font-weight-medium">[[ articleDetail.reference ]]</td>
                              </tr>
                              <tr>
                                <td>EAN</td>
                                <td class="font-weight-medium">[[ articleDetail.ean ]]</td>
                              </tr>
                              <tr>
                                <td>Stock</td>
                                <td class="font-weight-medium">
                                  <v-chip
                                    :color="getColor(articleDetail.stock, articleDetail.threshold)"
                                    dark
                                  >
                                    <span class="font-weight-medium">[[ articleDetail.stock ]]</span>
                                  </v-chip>
                                </td>
                              </tr>
                              <tr>
                                <td>Unit</td>
                                <td class="font-weight-medium">[[ articleDetail.unit ]]</td>
                              </tr>
                              <tr>
                                <td>Seuil Stock</td>
                                <td class="font-weight-medium">[[ articleDetail.threshold ]]</td>
                              </tr>
                              <tr>
                                <td>Propriétaire</td>
                                <td class="font-weight-medium">[[ articleDetail.proprietaire ]]</td>
                              </tr>
                              <tr>
                                <td>Position</td>
                                <td class="font-weight-medium">[[ articleDetail.position ]]</td>
                              </tr>
                              <tr>
                                <td>Description</td>
                                <td class="font-weight-medium">[[ articleDetail.description ]]</td>
                              </tr>
                              <tr>
                                <td>Date</td>
                                <td class="font-weight-medium">[[ articleDetail.date ]]</td>
                              </tr>
                              <tr>
                                <td></td>
                                <td class="font-weight-medium"></td>
                              </tr>
                            </tbody>
                          </template>
                        </v-simple-table>
                      </v-container>
                    </v-card-text>

                    <v-card-actions>
                      <v-spacer></v-spacer>
                      <v-btn
                        color="blue darken-1"
                        text
                        @click="dialogViewArticle = false"
                      >
                        Fermer
                      </v-btn>
                    </v-card-actions>
                  </v-card>
                </v-dialog> -->
                <v-icon
                  small
                  class="mr-2"
                  @click="editProduitItem(item)"
                >
                  mdi-pencil
                </v-icon>
                <v-icon
                  small
                  @click="deleteProduitItem(item)"
                >
                  mdi-delete
                </v-icon>
              </template>
              <template v-slot:no-data>
                <v-btn
                  color="primary"
                  @click="initialize"
                >
                  Réinitialiser
                </v-btn>
              </template>
            </v-data-table>
            <template>
              <div class="text-center ma-2">
                <v-snackbar
                  v-model="error_snackbar"
                  color="error"
                >
                  <span class="white--text">[[ error_message ]]</span>

                  <template v-slot:action="{ attrs }">
                    <v-btn
                      color="white"
                      text
                      v-bind="attrs"
                      @click="error_snackbar = false"
                    >
                      Close
                    </v-btn>
                  </template>
                </v-snackbar>
              </div>
            </template>
            <template>
              <div class="text-center ma-2">
                <v-snackbar
                  v-model="succes_produit_save"
                  color="success"
                  top
                >
                  <span class="white--text">[[ succes_produit_save_message ]]</span>

                  <template v-slot:action="{ attrs }">
                    <v-btn
                      color="white"
                      text
                      v-bind="attrs"
                      @click="succes_produit_save = false"
                    >
                      Close
                    </v-btn>
                  </template>
                </v-snackbar>
              </div>
            </template>
          </div>
        </template>




        <template id="materiels-template">
          <div class="container-fluid">
            <v-data-table
              :headers="headers"
              :items="materiels"
              :search="search"
              sort-by="name"
              class="elevation-1"
            >
              <template v-slot:item.article="{ item }">
                <span
                  v-for="(article, index) in articles"
                  :key="index"
                  class="font-weight-medium"
                >
                  <span v-if="article.id===item.article">[[ article.name ]]</span>
                </span>
              </template>
              <template v-slot:item.stock="{ item }">
                <span
                  v-for="(article, index) in articles"
                  :key="index"
                  class="font-weight-medium"
                >
                  <span v-if="article.id===item.article">
                    <v-chip
                      :color="getColor(article.stock, article.threshold)"
                      dark
                    >
                      [[ article.stock ]]
                    </v-chip>
                  </span>
                </span>
              </template>
              <template v-slot:item.unit="{ item }">
                <span
                  v-for="(article, index) in articles"
                  :key="index"
                  class="font-weight-medium"
                >
                  <span v-if="article.id===item.article">
                    <span
                      v-for="(unit, index) in units"
                      :key="index"
                      class="font-weight-medium"
                    >
                      <span v-if="unit.id===article.unit">[[ unit.name ]](s)</span>
                    </span>
                  </span>
                </span>
              </template>
              <template v-slot:item.position="{ item }">
                <span
                  v-for="(article, index) in articles"
                  :key="index"
                  class="font-weight-medium"
                >
                  <span v-if="article.id===item.article">[[ article.position ]]</span>
                </span>
              </template>
              <template v-slot:item.description="{ item }">
                <span
                  v-for="(article, index) in articles"
                  :key="index"
                  class="font-weight-medium"
                >
                  <span v-if="article.id===item.article">[[ article.description ]]</span>
                </span>
              </template>
              <template v-slot:top>
                <v-toolbar
                  flat
                >
                  <v-toolbar-title><h5 class="text-center">[[ materiels.length ]]</h5>Matériels</v-toolbar-title>
                  <v-divider
                    class="mx-4"
                    inset
                    vertical
                  ></v-divider>
                  <v-spacer></v-spacer>
                  <v-spacer></v-spacer>

                  <v-dialog
                    v-model="dialog"
                    max-width="500px"
                  >
                    <template v-slot:activator="{ on, attrs }">
                      <v-icon
                        color="primary"
                        dark
                        x-large
                        class="mb-2"
                        v-bind="attrs"
                        v-on="on"
                      >
                        mdi-plus-circle
                      </v-icon>
                    </template>
                    <v-card>
                      <v-card-title>
                        <span class="headline">[[ formTitle ]]</span>
                      </v-card-title>

                      <v-card-text>
                        <v-container>
                          <v-row>
                            <v-col
                              cols="12"
                              sm="6"
                              md="6"
                            >
                              <v-autocomplete
                                v-model="editedItem.article"
                                :items="articles"
                                item-text="name"
                                item-value="id"
                                color="primary"
                                label="Matériel"
                              ></v-autocomplete>
                            </v-col>
                          </v-row>
                        </v-container>
                      </v-card-text>

                      <v-card-actions>
                        <v-spacer></v-spacer>
                        <v-btn
                          color="blue darken-1"
                          text
                          @click="close"
                        >
                          Annuler
                        </v-btn>
                        <v-btn
                          color="blue darken-1"
                          text
                          @click="save_materiel"
                        >
                          Enregistrer
                        </v-btn>
                      </v-card-actions>
                    </v-card>
                  </v-dialog>

                  <v-spacer></v-spacer>
                  <v-text-field
                    v-model="search"
                    append-icon="mdi-magnify"
                    label="Rechercher"
                    single-line
                    hide-details
                    clearable
                  ></v-text-field>
                </v-toolbar>
              </template>
              <template v-slot:item.actions="{ item }">
                <!-- <v-dialog
                  v-model="dialogViewArticle"
                  max-width="600px"
                >
                  <template v-slot:activator="{ on, attrs }">
                    <v-icon
                      small
                      class="mr-2"
                      v-bind="attrs"
                      v-on="on"
                      @click="articleDetailView(item.article)"
                    >
                      mdi-eye
                    </v-icon>
                  </template>
                  <v-card>
                    <v-card-title>
                      <span class="headline">Detail matériel : <span class="font-weight-medium text-decoration-underline">[[ articleDetail.name ]]</span></span>
                    </v-card-title>

                    <v-card-text>
                      <v-container>
                        <v-simple-table dense>
                          <template v-slot:default>
                            <thead>
                              <tr>
                                <th class="text-left">

                                </th>
                                <th class="text-left">

                                </th>
                              </tr>
                            </thead>
                            <tbody>
                              <tr>
                                <td>Nom</td>
                                <td class="font-weight-medium">[[ articleDetail.name ]]</td>
                              </tr>
                              <tr>
                                <td>Modèle</td>
                                <td class="font-weight-medium">[[ articleDetail.articleModel ]]</td>
                              </tr>
                              <tr>
                                <td>Référence</td>
                                <td class="font-weight-medium">[[ articleDetail.reference ]]</td>
                              </tr>
                              <tr>
                                <td>EAN</td>
                                <td class="font-weight-medium">[[ articleDetail.ean ]]</td>
                              </tr>
                              <tr>
                                <td>Stock</td>
                                <td class="font-weight-medium">
                                  <v-chip
                                    :color="getColor(articleDetail.stock, articleDetail.threshold)"
                                    dark
                                  >
                                    <span class="font-weight-medium">[[ articleDetail.stock ]]</span>
                                  </v-chip>
                                </td>
                              </tr>
                              <tr>
                                <td>Unit</td>
                                <td class="font-weight-medium">[[ articleDetail.unit ]]</td>
                              </tr>
                              <tr>
                                <td>Seuil Stock</td>
                                <td class="font-weight-medium">[[ articleDetail.threshold ]]</td>
                              </tr>
                              <tr>
                                <td>Propriétaire</td>
                                <td class="font-weight-medium">[[ articleDetail.proprietaire ]]</td>
                              </tr>
                              <tr>
                                <td>Position</td>
                                <td class="font-weight-medium">[[ articleDetail.position ]]</td>
                              </tr>
                              <tr>
                                <td>Description</td>
                                <td class="font-weight-medium">[[ articleDetail.description ]]</td>
                              </tr>
                              <tr>
                                <td>Date</td>
                                <td class="font-weight-medium">[[ articleDetail.date ]]</td>
                              </tr>
                              <tr>
                                <td></td>
                                <td class="font-weight-medium"></td>
                              </tr>
                            </tbody>
                          </template>
                        </v-simple-table>
                      </v-container>
                    </v-card-text>

                    <v-card-actions>
                      <v-spacer></v-spacer>
                      <v-btn
                        color="blue darken-1"
                        text
                        @click="closeViewArticle"
                      >
                        Fermer
                      </v-btn>
                    </v-card-actions>
                  </v-card>
                </v-dialog> -->
                <v-icon
                  small
                  class="mr-2"
                  @click="editMaterielItem(item)"
                >
                  mdi-pencil
                </v-icon>
                <v-icon
                  small
                  @click="deleteMaterielItem(item)"
                >
                  mdi-delete
                </v-icon>
              </template>
              <template v-slot:no-data>
                <v-btn
                  color="primary"
                  @click="initialize"
                >
                  Réinitialiser
                </v-btn>
              </template>
            </v-data-table>
            <template>
              <div class="text-center ma-2">
                <v-snackbar
                  v-model="error_snackbar"
                  color="error"
                >
                  <span class="white--text">[[ error_message ]]</span>

                  <template v-slot:action="{ attrs }">
                    <v-btn
                      color="white"
                      text
                      v-bind="attrs"
                      @click="error_snackbar = false"
                    >
                      Close
                    </v-btn>
                  </template>
                </v-snackbar>
              </div>
            </template>
            <template>
              <div class="text-center ma-2">
                <v-snackbar
                  v-model="succes_materiel_save"
                  color="success"
                  top
                >
                  <span class="white--text">[[ succes_materiel_save_message ]]</span>

                  <template v-slot:action="{ attrs }">
                    <v-btn
                      color="white"
                      text
                      v-bind="attrs"
                      @click="succes_materiel_save = false"
                    >
                      Close
                    </v-btn>
                  </template>
                </v-snackbar>
              </div>
            </template>
          </div>
        </template>




        <template id="fournisseurs-template">
          <div class="container-fluid">
            <v-data-table
              :headers="headers"
              :items="fournisseurs"
              :search="search"
              sort-by="name"
              class="elevation-1"
            >
              <template v-slot:top>
                <v-toolbar
                  flat
                >
                  <v-toolbar-title><h5 class="text-center">[[ fournisseurs.length ]]</h5>Fournisseurs</v-toolbar-title>
                  <v-divider
                    class="mx-4"
                    inset
                    vertical
                  ></v-divider>
                  <v-spacer></v-spacer>
                  <v-spacer></v-spacer>

                  <v-dialog
                    v-model="dialog"
                    max-width="500px"
                  >
                    <template v-slot:activator="{ on, attrs }">
                      <v-icon
                        color="primary"
                        dark
                        x-large
                        class="mb-2"
                        v-bind="attrs"
                        v-on="on"
                      >
                        mdi-plus-circle
                      </v-icon>
                    </template>
                    <v-card>
                      <v-card-title>
                        <span class="headline">[[ formTitle ]]</span>
                      </v-card-title>

                      <v-card-text>
                        <v-container>
                          <v-row>
                            <v-col
                              cols="12"
                              sm="6"
                              md="12"
                            >
                              <v-text-field
                                v-model="editedItem.name"
                                type="text"
                                label="Nom"
                              ></v-text-field>
                            </v-col>
                            <v-col
                              cols="12"
                              sm="6"
                              md="6"
                            >
                              <v-text-field
                                v-model="editedItem.phoneNumber"
                                type="text"
                                label="Numéro"
                              ></v-text-field>
                            </v-col>
                            <v-col
                              cols="12"
                              sm="6"
                              md="6"
                            >
                              <v-text-field
                                v-model="editedItem.fax"
                                type="text"
                                label="Fax"
                              ></v-text-field>
                            </v-col>
                            <v-col
                              cols="12"
                              sm="6"
                              md="6"
                            >
                              <v-text-field
                                v-model="editedItem.email"
                                type="text"
                                label="E-mail"
                              ></v-text-field>
                            </v-col>
                            <v-col
                              cols="12"
                              sm="6"
                              md="6"
                            >
                              <v-text-field
                                v-model="editedItem.site_web"
                                type="text"
                                label="Site Web"
                              ></v-text-field>
                            </v-col>
                            <v-col
                              cols="12"
                              sm="6"
                              md="12"
                            >
                              <v-textarea
                                auto-grow
                                rows="1"
                                v-model="editedItem.description"
                                label="Description"
                              ></v-textarea>
                            </v-col>
                          </v-row>
                        </v-container>
                      </v-card-text>

                      <v-card-actions>
                        <v-spacer></v-spacer>
                        <v-btn
                          color="blue darken-1"
                          text
                          @click="close"
                        >
                          Annuler
                        </v-btn>
                        <v-btn
                          color="blue darken-1"
                          text
                          @click="save_fournisseur"
                        >
                          Enregistrer
                        </v-btn>
                      </v-card-actions>
                    </v-card>
                  </v-dialog>

                  <v-spacer></v-spacer>
                  <v-text-field
                    v-model="search"
                    append-icon="mdi-magnify"
                    label="Rechercher"
                    single-line
                    hide-details
                    clearable
                  ></v-text-field>
                </v-toolbar>
              </template>
              <template v-slot:item.actions="{ item }">
                <!-- <v-dialog
                  v-model="dialogViewFournisseur"
                  max-width="600px"
                >
                  <template v-slot:activator="{ on, attrs }">
                    <v-icon
                      small
                      class="mr-2"
                      v-bind="attrs"
                      v-on="on"
                      @click="fournisseurDetailView(item)"
                    >
                      mdi-eye
                    </v-icon>
                  </template>
                  <v-card>
                    <v-card-title>
                      <span class="headline">Detail fournisseur : <span class="font-weight-medium text-decoration-underline">[[ fournisseurDetail.name ]]</span></span>
                    </v-card-title>

                    <v-card-text>
                      <v-container>
                        <v-simple-table dense>
                          <template v-slot:default>
                            <thead>
                              <tr>
                                <th class="text-left">

                                </th>
                                <th class="text-left">

                                </th>
                              </tr>
                            </thead>
                            <tbody>
                              <tr>
                                <td>Nom</td>
                                <td class="font-weight-medium">[[ fournisseurDetail.name ]]</td>
                              </tr>
                              <tr>
                                <td>Numéro</td>
                                <td class="font-weight-medium">[[ fournisseurDetail.phoneNumber ]]</td>
                              </tr>
                              <tr>
                                <td>Fax</td>
                                <td class="font-weight-medium">[[ fournisseurDetail.fax ]]</td>
                              </tr>
                              <tr>
                                <td>E-mail</td>
                                <td class="font-weight-medium">[[ fournisseurDetail.email ]]</td>
                              </tr>
                              <tr>
                                <td>Site Web</td>
                                <td class="font-weight-medium">[[ fournisseurDetail.site_web ]]</td>
                              </tr>
                              <tr>
                                <td>Description</td>
                                <td class="font-weight-medium">[[ fournisseurDetail.description ]]</td>
                              </tr>
                              <tr>
                                <td>Date</td>
                                <td class="font-weight-medium">[[ fournisseurDetail.date ]]</td>
                              </tr>
                              <tr>
                                <td></td>
                                <td class="font-weight-medium"></td>
                              </tr>
                            </tbody>
                          </template>
                        </v-simple-table>
                      </v-container>
                    </v-card-text>
                    <v-card-actions>
                      <v-spacer></v-spacer>
                      <v-btn
                        color="blue darken-1"
                        text
                        @click="dialogViewFournisseur = false"
                      >
                        Fermer
                      </v-btn>
                    </v-card-actions>
                  </v-card>
                </v-dialog> -->

                <v-icon
                  small
                  class="mr-2"
                  @click="editFournisseurItem(item)"
                >
                  mdi-pencil
                </v-icon>
                <v-icon
                  small
                  @click="deleteFournisseurItem(item)"
                >
                  mdi-delete
                </v-icon>
              </template>
              <template v-slot:no-data>
                <v-btn
                  color="primary"
                  @click="initialize"
                >
                  Réinitialiser
                </v-btn>
              </template>
            </v-data-table>
            <template>
              <div class="text-center ma-2">
                <v-snackbar
                  v-model="error_snackbar"
                  color="error"
                >
                  <span class="white--text">[[ error_message ]]</span>

                  <template v-slot:action="{ attrs }">
                    <v-btn
                      color="white"
                      text
                      v-bind="attrs"
                      @click="error_snackbar = false"
                    >
                      Close
                    </v-btn>
                  </template>
                </v-snackbar>
              </div>
            </template>
            <template>
              <div class="text-center ma-2">
                <v-snackbar
                  v-model="succes_fournisseur_save"
                  color="success"
                  top
                >
                  <span class="white--text">[[ succes_fournisseur_save_message ]]</span>

                  <template v-slot:action="{ attrs }">
                    <v-btn
                      color="white"
                      text
                      v-bind="attrs"
                      @click="succes_fournisseur_save = false"
                    >
                      Close
                    </v-btn>
                  </template>
                </v-snackbar>
              </div>
            </template>
            <template>
              <div class="text-center ma-2">
                <v-snackbar
                  v-model="error_fournisseur_save"
                  color="error"
                  top
                >
                  <span class="white--text">[[ error_fournisseur_message ]]</span>

                  <template v-slot:action="{ attrs }">
                    <v-btn
                      color="white"
                      text
                      v-bind="attrs"
                      @click="error_fournisseur_save = false"
                    >
                      Close
                    </v-btn>
                  </template>
                </v-snackbar>
              </div>
            </template>
          </div>
        </template>




        <template id="stocks-template">
          <div class="container-fluid">
            <v-data-table
              :headers="headers"
              :items="articles"
              :search="search"
              sort-by="name"
              class="elevation-1"
            >
              <template v-slot:item.unit="{ item }">
                <span
                  v-for="(unit, index) in units"
                  :key="index"
                  class="font-weight-medium"
                >
                  <span v-if="unit.id===item.unit">[[ unit.name ]](s)</span>
                </span>
              </template>
              <template v-slot:item.stock="{ item }">
                <v-chip
                  :color="getColor(item.stock, item.threshold)"
                  dark
                >
                  <span class="font-weight-medium">[[ item.stock ]] </span>
                </v-chip>
              </template>
              <template v-slot:top>
                <v-toolbar
                  flat
                >
                  <v-toolbar-title><h5 class="text-center">[[ articles.length ]]</h5>Articles</v-toolbar-title>
                  <v-divider
                    class="mx-4"
                    inset
                    vertical
                  ></v-divider>
                  <v-spacer></v-spacer>
                  <v-spacer></v-spacer>

                  <v-dialog
                    v-model="dialog"
                    max-width="500px"
                  >
                    <template v-slot:activator="{ on, attrs }">
                      <v-icon
                        color="primary"
                        dark
                        x-large
                        class="mb-2"
                        v-bind="attrs"
                        v-on="on"
                      >
                        mdi-plus-circle
                      </v-icon>
                    </template>
                    <v-card>
                      <v-card-title>
                        <span class="headline">[[ formTitle ]]</span>
                      </v-card-title>

                      <v-card-text>
                        <v-container>
                          <v-row>
                            <v-col
                              cols="12"
                              sm="6"
                              md="6"
                            >
                              <v-text-field
                                v-model="editedItem.name"
                                label="Nom"
                              ></v-text-field>
                            </v-col>
                            <v-col
                              cols="12"
                              sm="6"
                              md="6"
                            >
                              <v-text-field
                                v-model="editedItem.articleModel"
                                label="Modèle"
                              ></v-text-field>
                            </v-col>
                            <v-col
                              cols="12"
                              sm="6"
                              md="4"
                            >
                              <v-text-field
                                v-model="editedItem.reference"
                                label="Référence"
                              ></v-text-field>
                            </v-col>
                            <v-col
                              cols="12"
                              sm="6"
                              md="4"
                            >
                              <v-text-field
                                v-model="editedItem.stock"
                                type="number"
                                min="1"
                                label="Stock"
                              ></v-text-field>
                            </v-col>
                            <v-col
                              cols="12"
                              sm="6"
                              md="4"
                            >
                              <v-autocomplete
                                v-model="editedItem.unit"
                                :items="units"
                                item-text="name"
                                item-value="id"
                                color="primary"
                                label="Unité Stock"
                              ></v-autocomplete>
                            </v-col>
                            <v-col
                              cols="12"
                              sm="6"
                              md="5"
                            >
                              <v-text-field
                                v-model="editedItem.threshold"
                                type="number"
                                min="1"
                                label="Seuil Stock"
                              ></v-text-field>
                            </v-col>
                            <v-col
                              cols="12"
                              sm="6"
                              md="7"
                            >
                              <v-textarea
                                auto-grow
                                rows="1"
                                v-model="editedItem.position"
                                label="Position"
                              ></v-textarea>
                            </v-col>
                            <v-col
                              cols="12"
                              sm="6"
                              md="5"
                            >
                              <v-textarea
                                auto-grow
                                rows="1"
                                v-model="editedItem.proprietaire"
                                label="Propriétaire"
                              ></v-textarea>
                            </v-col>
                            <v-col
                              cols="12"
                              sm="6"
                              md="7"
                            >
                              <v-textarea
                                auto-grow
                                rows="1"
                                v-model="editedItem.description"
                                label="Description"
                              ></v-textarea>
                            </v-col>
                          </v-row>
                        </v-container>
                      </v-card-text>

                      <v-card-actions>
                        <v-spacer></v-spacer>
                        <v-btn
                          color="blue darken-1"
                          text
                          @click="close"
                        >
                          Annuler
                        </v-btn>
                        <v-btn
                          color="blue darken-1"
                          text
                          @click="save_article"
                        >
                          Enregistrer
                        </v-btn>
                      </v-card-actions>
                    </v-card>
                  </v-dialog>

                  <v-spacer></v-spacer>
                  <v-text-field
                    v-model="search"
                    append-icon="mdi-magnify"
                    label="Rechercher"
                    single-line
                    hide-details
                    clearable
                  ></v-text-field>
                </v-toolbar>
              </template>
              <template v-slot:item.actions="{ item }">
                <v-icon
                  small
                  class="mr-2"
                  @click="editArticleItem(item)"
                >
                  mdi-pencil
                </v-icon>
                <v-icon
                  small
                  @click="deleteArticleItem(item)"
                >
                  mdi-delete
                </v-icon>
              </template>
              <template v-slot:no-data>
                <v-btn
                  color="primary"
                  @click="initialize"
                >
                  Réinitialiser
                </v-btn>
              </template>
            </v-data-table>
            <template>
              <div class="text-center ma-2">
                <v-snackbar
                  v-model="error_snackbar"
                  color="error"
                >
                  <span class="white--text">[[ error_message ]]</span>

                  <template v-slot:action="{ attrs }">
                    <v-btn
                      color="white"
                      text
                      v-bind="attrs"
                      @click="error_snackbar = false"
                    >
                      Close
                    </v-btn>
                  </template>
                </v-snackbar>
              </div>
            </template>
            <template>
              <div class="text-center ma-2">
                <v-snackbar
                  v-model="succes_article_save"
                  color="success"
                  top
                >
                  <span class="white--text">[[ succes_article_save_message ]]</span>

                  <template v-slot:action="{ attrs }">
                    <v-btn
                      color="white"
                      text
                      v-bind="attrs"
                      @click="succes_article_save = false"
                    >
                      Close
                    </v-btn>
                  </template>
                </v-snackbar>
              </div>
            </template>
          </div>
        </template>




        <template id="entrees-template">
          <div class="content"> <!-- content -->
            <div class="container"> <!-- container -->
              <v-card>
                <v-card-text>
                  <v-container>
                    <v-row>
                      <v-col
                        cols="12"
                        sm="6"
                        md="3"
                        class="text-center"
                      >
                        <h3>Emprunteur</h3>
                        <br>
                        <v-autocomplete
                          v-model="emprunteur"
                          :items="emprunteurs"
                          item-text="username"
                          item-value="id"
                          color="primary"
                          label="Nom Emprunteur"
                          solo
                        ></v-autocomplete>
                      </v-col>
                      <v-col
                        cols="12"
                        sm="6"
                        md="6"
                        class="text-center"
                      >
                        <div class="invoice-box text-center">
                          <h2>Entrée Stock</h2>
                          <br>
                          <!-- [[ typeof entrees ]] -->
                          <p class="font-weight-black">REF :  [[ get_next_entry_ref ]]</p>
                        </div>
                      </v-col>
                      <v-col
                        cols="12"
                        sm="6"
                        md="3"
                        class="text-center"
                      >
                        <h3>Gestionnaire</h3>
                        <br>
                        <v-text-field
                          v-model="current_user.username"
                          label="Solo"
                          placeholder="Current User"
                          solo
                          disabled
                        ></v-text-field>
                      </v-col>
                    </v-row>
                  </v-container>
                </v-card-text>
              </v-card>
              <div class="row"> <!-- row -->
                <div class="col-12"> <!-- col-12 -->
                  <div
                    class="invoice-box"
                    id="invoicebox-div"
                    ref="invoicebox_div"
                  > <!-- invoice-box -->
                    <table
                      cellpadding="0"
                      cellspacing="0"
                      id="invoicebox-table"
                    > <!-- table -->
                      <tr
                        class="heading"
                      >
                        <td>Articles</td>
                        <td>Quantité</td>
                        <td>Observation</td>
                        <td>Actions</td>
                      </tr>

                      <tr
                        v-for="(item, index) in items"
                        :key="index"
                        class="item"
                      >
                        <td>
                          <v-autocomplete
                            v-model="item.article"
                            :items="articles"
                            item-text="name"
                            return-object
                            color="primary"
                            label="Article"
                            :suffix="item.article.unit ? units[item.article.unit -1].name : ''"
                          >
                          </v-autocomplete>
                        </td>
                        <td>
                          <v-text-field
                            v-model="item.quantity"
                            type="number"
                            min="1"
                            label="Article Quantity"
                            required
                          >
                          </v-text-field>
                        </td>
                        <td>
                          <v-textarea
                            auto-grow
                            rows="1"
                            v-model="item.observation"
                            label="Observation: Statut matériel"
                            required
                            clearable
                          >
                          </v-textarea>
                        </td>
                        <td>
                          <br>
                          <v-icon
                            small
                            @click="deleteRow(item)"
                          >
                            mdi-delete
                          </v-icon>
                        </td>
                      </tr>

                      <tr>
                        <td colspan="5">
                          <button
                            class="btn-add-row"
                            @click="addRow"
                          >
                            Nouvelle Ligne
                          </button>
                        </td>
                      </tr>
                    </table> <!-- End of table -->
                  </div> <!--End of invoice-box  -->

                  <div class="invoice-box text-center">
                    <v-btn
                      color="primary"
                      dark
                      rounded
                      class="mb-2"
                      @click="save_entree"
                    >
                      Enregistrer
                    </v-btn>
                    <v-snackbar
                      v-model="snackbar"
                      :color="snackbarColor"
                    >
                      <span v-if="message != 'Empty message'">
                        [[ message ]]
                      </span>
                      <span v-if="error != 'Empty error'">
                        <span v-for="(text, index) in error.split('\n')" :key="index">
                          <span v-if="text != error.split('\n')[index-1]">
                            [[ text ]]
                            <br>
                          </span>
                        </span>
                      </span>
                      <template v-slot:action="{ attrs }">
                        <v-btn
                          text
                          v-bind="attrs"
                          @click="snackbar = false"
                        >
                          Close
                        </v-btn>
                      </template>
                    </v-snackbar>
                  </div>
                </div> <!-- End of col-12  -->
              </div> <!-- End of row -->
            </div> <!-- End of container -->

            <hr class="hr_style">
            <br>

            <div class="container-fluid">
              <v-data-table
                :headers="headers"
                :items="entrees"
                :search="search"
                sort-by="reference"
                class="elevation-1"
              >
                <template v-slot:top>
                  <v-toolbar
                    flat
                  >
                    <v-toolbar-title><h5 class="text-center">[[ entrees.length ]]</h5>Entrées</v-toolbar-title>
                    <v-divider
                      class="mx-4"
                      inset
                      vertical
                    ></v-divider>
                    <v-spacer></v-spacer>

                    <v-text-field
                      v-model="search"
                      append-icon="mdi-magnify"
                      label="Rechercher"
                      single-line
                      hide-details
                      clearable
                    ></v-text-field>
                  </v-toolbar>
                </template>

                <template v-slot:item.data="{ item }">
                  <v-expansion-panels
                    focusable
                  >
                    <v-expansion-panel>
                      <v-expansion-panel-header
                        expand-icon="mdi-menu-down"
                        color="#CFE5E2"
                        class="font-weight-medium"
                      >
                        <span color="white">Articles retournés</span>
                      </v-expansion-panel-header>
                      <v-expansion-panel-content color="#E4F0EE">
                        <p
                          v-for="(d, index) in JSON.parse(item.data)"
                          :key="index"
                        >
                          <span>
                            - [[ d.article.name ]] :
                            <span class="font-weight-medium red--text">[[ JSON.parse(item.data)[0].quantity ]]</span>
                            <span
                              v-for="(unit, index) in units"
                              :key="index"
                              class="font-weight-medium"
                            >
                              <span v-if="unit.id===d.article.unit">[[ unit.name ]](s)</span>
                            </span>
                          </span>
                        </p>
                      </v-expansion-panel-content>
                    </v-expansion-panel>
                  </v-expansion-panels>
                </template>

                <template v-slot:item.gestionnaire="{ item }">
                  <span
                    v-for="(user, index) in users"
                    :key="index"
                  >
                    <span v-if="user.id===item.gestionnaire">[[ user.username ]]</span>
                  </span>
                </template>

                <template v-slot:item.demandeur="{ item }">
                  <span
                    v-for="(user, index) in users"
                    :key="index"
                  >
                    <span v-if="user.id===item.demandeur">[[ user.username ]]</span>
                  </span>
                </template>

                <template v-slot:no-data>
                  <v-btn
                    color="primary"
                    @click="initialize"
                  >
                    Réinitialiser
                  </v-btn>
                </template>
              </v-data-table>
              <template>
                <div class="text-center ma-2">
                  <v-snackbar
                    v-model="error_snackbar"
                    color="error"
                  >
                    <span class="white--text">[[ error_message ]]</span>

                    <template v-slot:action="{ attrs }">
                      <v-btn
                        color="white"
                        text
                        v-bind="attrs"
                        @click="error_snackbar = false"
                      >
                        Close
                      </v-btn>
                    </template>
                  </v-snackbar>
                </div>
              </template>
            </div><!-- End of container -->
          </div> <!-- End of content -->
        </template>

        <template id="sorties-template">
          <div class="content"> <!-- content -->
            <div class="container"> <!-- container -->
              <v-card>
                <v-card-text>
                  <v-container>
                    <v-row>
                      <v-col
                        cols="12"
                        sm="6"
                        md="3"
                        class="text-center"
                      >
                        <h3>Emprunteur</h3>
                        <br>
                        <v-autocomplete
                          v-model="emprunteur"
                          :items="emprunteurs"
                          item-text="username"
                          item-value="id"
                          color="primary"
                          label="Nom Emprunteur"
                          solo
                        >
                        </v-autocomplete>
                      </v-col>
                      <v-col
                        cols="12"
                        sm="6"
                        md="6"
                        class="text-center"
                      >
                        <div class="invoice-box text-center">
                          <h2>Sortie Stock</h2>
                          <br>
                          <!-- [[ typeof sorties ]] -->
                          <p class="font-weight-black">REF :  [[ get_next_sortie_ref ]]</p>
                        </div>
                      </v-col>
                      <v-col
                        cols="12"
                        sm="6"
                        md="3"
                        class="text-center"
                      >
                        <h3>Gestionnaire</h3>
                        <br>
                        <v-text-field
                          v-model="current_user.username"
                          label="Solo"
                          placeholder="Current User"
                          solo
                          disabled
                        ></v-text-field>
                      </v-col>
                    </v-row>
                  </v-container>
                </v-card-text>
              </v-card>
              <div class="row"> <!-- row -->
                <div class="col-12"> <!-- col-12 -->
                  <div
                    class="invoice-box"
                    id="invoicebox-div"
                    ref="invoicebox_div"
                  > <!-- invoice-box -->
                    <table
                      cellpadding="0"
                      cellspacing="0"
                      id="invoicebox-table"
                    > <!-- table -->
                      <tr
                        class="heading"
                      >
                        <td>Articles</td>
                        <td>Quantité</td>
                        <td>Observation</td>
                        <td>Actions</td>
                      </tr>

                      <tr
                        v-for="(item, index) in items"
                        :key="index"
                        class="item"
                      >
                        <td>
                          <v-autocomplete
                            v-model="item.article"
                            :items="articles"
                            item-text="name"
                            return-object
                            color="primary"
                            label="Article"
                            :suffix="item.article.unit ? units[item.article.unit -1].name : ''"
                          >
                          </v-autocomplete>
                        </td>
                        <td>
                          <v-text-field
                            v-model="item.quantity"
                            :rules="[() => item.article.stock >= item.quantity || 'Quantité indisponible']"
                            type="number"
                            min="1"
                            label="Article Quantity"
                            required
                          ></v-text-field>
                        </td>
                        <td>
                          <v-textarea
                            auto-grow
                            rows="1"
                            v-model="item.observation"
                            label="Observation: Statut matériel"
                            required
                            clearable
                          >
                          </v-textarea>
                        </td>
                        <td>
                          <br>
                          <v-icon
                            small
                            @click="deleteRow(item)"
                          >
                            mdi-delete
                          </v-icon>
                        </td>
                      </tr>

                      <tr>
                        <td colspan="5">
                          <button
                            class="btn-add-row"
                            @click="addRow"
                          >
                            Nouvelle Ligne
                          </button>
                        </td>
                      </tr>

                      <tr class="">
                        <td colspan="10">
                          <v-textarea
                            v-model="motif"
                            auto-grow
                            rows="1"
                            label="Motif"
                            required
                            clearable
                          ></v-textarea>
                        </td>
                      </tr>
                    </table> <!-- End of table -->
                  </div> <!--End of invoice-box  -->

                  <div class="invoice-box text-center">
                    <v-btn
                      color="primary"
                      dark
                      rounded
                      class="mb-2"
                      @click="save_sortie"
                    >
                      Enregistrer
                    </v-btn>
                    <v-snackbar
                      v-model="snackbar"
                      :color="snackbarColor"
                    >
                      <span v-if="message != 'Empty message'">
                        [[ message ]]
                      </span>
                      <span v-if="error != 'Empty error'">
                        <span v-for="(text, index) in error.split('\n')" :key="index">
                          <span v-if="text != error.split('\n')[index-1]">
                            [[ text ]]
                            <br>
                          </span>
                        </span>
                      </span>
                      <template v-slot:action="{ attrs }">
                        <v-btn
                          text
                          v-bind="attrs"
                          @click="snackbar = false"
                        >
                          Close
                        </v-btn>
                      </template>
                    </v-snackbar>
                  </div>
                </div> <!-- End of col-12  -->
              </div> <!-- End of row -->
            </div> <!-- End of container -->

            <hr class="hr_style">
            <br>

            <div class="container-fluid">
              <v-data-table
                :headers="headers"
                :items="sorties"
                :search="search"
                sort-by="reference"
                class="elevation-1"
              >
                <template v-slot:top>
                  <v-toolbar
                    flat
                  >
                    <v-toolbar-title><h5 class="text-center">[[ sorties.length ]]</h5>Sorties</v-toolbar-title>
                    <v-divider
                      class="mx-4"
                      inset
                      vertical
                    ></v-divider>
                    <v-spacer></v-spacer>

                    <v-text-field
                      v-model="search"
                      append-icon="mdi-magnify"
                      label="Rechercher"
                      single-line
                      hide-details
                      clearable
                    ></v-text-field>
                  </v-toolbar>
                </template>

                <template v-slot:item.data="{ item }">
                  <v-expansion-panels
                    focusable
                  >
                    <v-expansion-panel>
                      <v-expansion-panel-header
                        expand-icon="mdi-menu-down"
                        color="#CFE5E2"
                        class="font-weight-medium"
                      >
                        <span color="white">Articles Sortis</span>
                      </v-expansion-panel-header>
                      <v-expansion-panel-content color="#E4F0EE">
                        <p
                          v-for="(d, index) in JSON.parse(item.data)"
                          :key="index"
                        >
                          <span>
                            - [[ d.article.name ]] :
                            <span class="font-weight-medium red--text">[[ JSON.parse(item.data)[0].quantity ]]</span>
                            <span
                              v-for="(unit, index) in units"
                              :key="index"
                              class="font-weight-medium"
                            >
                              <span v-if="unit.id===d.article.unit">[[ unit.name ]](s)</span>
                            </span>
                          </span>
                        </p>
                      </v-expansion-panel-content>
                    </v-expansion-panel>
                  </v-expansion-panels>
                </template>

                <template v-slot:item.gestionnaire="{ item }">
                  <span
                    v-for="(user, index) in users"
                    :key="index"
                  >
                    <span v-if="user.id===item.gestionnaire">[[ user.username ]]</span>
                  </span>
                </template>

                <template v-slot:item.demandeur="{ item }">
                  <span
                    v-for="(user, index) in users"
                    :key="index"
                  >
                    <span v-if="user.id===item.demandeur">[[ user.username ]]</span>
                  </span>
                </template>

                <!-- <template v-slot:item.date="{ item }">
                  <span>[[ item.date ]]</span>
                </template> -->

                <template v-slot:no-data>
                  <v-btn
                    color="primary"
                    @click="initialize"
                  >
                    Réinitialiser
                  </v-btn>
                </template>
              </v-data-table>
              <template>
                <div class="text-center ma-2">
                  <v-snackbar
                    v-model="error_snackbar"
                    color="error"
                  >
                    <span class="white--text">[[ error_message ]]</span>

                    <template v-slot:action="{ attrs }">
                      <v-btn
                        color="white"
                        text
                        v-bind="attrs"
                        @click="error_snackbar = false"
                      >
                        Close
                      </v-btn>
                    </template>
                  </v-snackbar>
                </div>
              </template>
            </div><!-- End of container -->
          </div> <!-- End of content -->
        </template>


        <template id="gstock-empty-template">
            <div class="realtime-empty">
                <v-row
                    align="center"
                    justify="center"
                    class="parent_center"
                >
                    Empty
                </v-row>
            </div>
        </template>

        <template id="gstock-notfound-template">
            <div class="realtime-notfound">
                <v-row
                    align="center"
                    justify="center"
                    class="parent_center"
                >
                    <v-col class="text-center child_center">
                        <div class="primary">
                            <h1 style="color: white">(404) Page NotFound</h1>
                        </div>
                    </v-col>
                </v-row>
            </div>
        </template>
        <!-- End Vue templates -->

        <!-- Vue app -->
        <script>
            // global variable

            var today_date = (new Date()).getDate() + '/' + ((new Date()).getMonth() + 1) + '/' + ((new Date()).getFullYear())

            const fcfa = new Intl.NumberFormat('fr-FR', {
                style: 'currency',
                currency: 'CFA',
                minimumFractionDigits: 2,
            })

            function addZero (num) {
              return (num >= 0 && num < 10) ? '0' + num : num + ''
            }

            var now = new Date()
            var strDateTime = [[now.getFullYear(), addZero(now.getMonth() + 1), addZero(now.getDate())].join('-'),
                               [addZero(now.getHours()), addZero(now.getMinutes()), addZero(now.getSeconds())].join(':'),
                               // now.getHours() >= 12 ? 'PM' : 'AM',
            ].join(' ')



            // components
            // dashboard
            Dashboard = Vue.component('dashboard', {
                props: ['current_username', ],
                delimiters: ['[[',']]'],
                data: function () {
                    return {
                      dialogViewSortie: false,
                      sortieDetail: {},
                      dialogViewEntree: false,
                      error_snackbar: false,
                      error_message: '',
                      entreeDetail: {},
                      getDATA: [{name: '', quantity: 0, unit: ''}],
                      length: 3,
                      window: 0,
                      connected_user: {},
                      produits: {},
                      articles: {},
                      materiels: {},
                      suppliers: {},
                      units: {},
                      users: {},
                      entrees: {},
                      sorties: {},
                      alerts_entrees: {},
                      alerts_sorties: {},
                    }
                },

                created: function () {
                  this.initialize()
                },

                computed: function ()  {

                },

                methods:  {
                  initialize () {
                    axios.get('http://127.0.0.1:8000/gstock/drf/produits-viewsets/')
                      .then(response => {
                        this.produits = response.data
                      })
                      .catch(error => {
                        if (error.message.includes("403") || error.message.includes("401")) {
                          this.error_message = "Accès refusé"
                        } else {
                          this.error_message = error.message
                        }

                        this.error_snackbar = true
                      })
                    axios.get('http://127.0.0.1:8000/gstock/drf/articles-viewsets/')
                      .then(response => {
                        this.articles = response.data
                      })
                      .catch(error => {
                        if (error.message.includes("403") || error.message.includes("401")) {
                          this.error_message = "Accès refusé"
                        } else {
                          this.error_message = error.message
                        }

                        this.error_snackbar = true
                      })
                    axios.get('http://127.0.0.1:8000/gstock/drf/suppliers-viewsets/')
                      .then(response => {
                        this.suppliers = response.data
                      })
                      .catch(error => {
                        if (error.message.includes("403") || error.message.includes("401")) {
                          this.error_message = "Accès refusé"
                        } else {
                          this.error_message = error.message
                        }

                        this.error_snackbar = true
                      })
                    axios.get('http://127.0.0.1:8000/gstock/drf/articles/unit/')
                      .then(response => {
                        this.units = response.data
                        this.units.sort(function (a, b) {
                          return a.id - b.id
                        })
                      })
                      .catch(error => {
                        if (error.message.includes("403") || error.message.includes("401")) {
                          this.error_message = "Accès refusé"
                        } else {
                          this.error_message = error.message
                        }

                        this.error_snackbar = true
                      })
                    axios.get('http://127.0.0.1:8000/gstock/drf/users-viewsets/')
                      .then(response => {
                        this.users = response.data

                        this.connected_user = JSON.parse(localStorage.getItem("vuex")).user;

                        this.users.forEach((item, index) => {
                          if (this.connected_user === item.id) {
                            this.connected_user = item
                          }
                        })
                      })
                      .catch(error => {
                        if (error.message.includes("403") || error.message.includes("401")) {
                          this.error_message = "Accès refusé"
                        } else {
                          this.error_message = error.message
                        }

                        this.error_snackbar = true
                      })
                    axios.get('http://127.0.0.1:8000/gstock/drf/entrees/get/global/entrees/')
                      .then(response => {
                        this.entrees = response.data
                      })
                      .catch(error => {
                        if (error.message.includes("403") || error.message.includes("401")) {
                          this.error_message = "Accès refusé"
                        } else {
                          this.error_message = error.message
                        }

                        this.error_snackbar = true
                      })
                    axios.get('http://127.0.0.1:8000/gstock/drf/sorties/get/global/sorties/')
                      .then(response => {
                        this.sorties = response.data
                      })
                      .catch(error => {
                        if (error.message.includes("403") || error.message.includes("401")) {
                          this.error_message = "Accès refusé"
                        } else {
                          this.error_message = error.message
                        }

                        this.error_snackbar = true
                      })
                    axios.get('http://127.0.0.1:8000/gstock/drf/materiels-viewsets/')
                      .then(response => {
                        this.materiels = response.data
                      })
                      .catch(error => {
                        if (error.message.includes("403") || error.message.includes("401")) {
                          this.error_message = "Accès refusé"
                        } else {
                          this.error_message = error.message
                        }

                        this.error_snackbar = true
                      })
                    axios.get('http://127.0.0.1:8000/gstock/drf/sorties/current/sorties/')
                      .then(response => {
                        this.alerts_sorties = response.data
                      })
                      .catch(error => {
                        if (error.message.includes("403") || error.message.includes("401")) {
                          this.error_message = "Accès refusé"
                        } else {
                          this.error_message = error.message
                        }

                        this.error_snackbar = true
                      })
                    axios.get('http://127.0.0.1:8000/gstock/drf/entrees/current/entrees/')
                      .then(response => {
                        this.alerts_entrees = response.data
                      })
                      .catch(error => {
                        if (error.message.includes("403") || error.message.includes("401")) {
                          this.error_message = "Accès refusé"
                        } else {
                          this.error_message = error.message
                        }

                        this.error_snackbar = true
                      })
                  },
                  sortieDetailView (referenceSortie) {
                    this.getDATA = []

                    this.alerts_sorties.forEach(item => {
                      if (item.reference === referenceSortie) {
                        this.sortieDetail = item
                        // alert(typeof JSON.parse(item.data))

                        JSON.parse(item.data).forEach(itemSorti => {
                          // alert(Object.values(itemSorti.article))
                          this.articles.forEach(itemArticle => {
                            if (itemArticle.id === itemSorti.article.id) {
                              this.units.forEach(itemUnit => {
                                if (itemUnit.id === itemSorti.article.unit) {

                                  this.getDATA.push({name: itemSorti.article.name, quantity: itemSorti.quantity, unit: itemUnit.name})
                                }
                              })
                            }
                          })
                        })
                      }//en if alerts_sorties
                    })
                  },
                  closeViewSortie () {
                    this.dialogViewSortie = false
                    this.sortieDetail = {}
                  },
                  entreeDetailView (referenceEntree) {
                    this.getDATA = []

                    this.alerts_entrees.forEach(item => {
                      if (item.reference === referenceEntree) {
                        this.entreeDetail = item

                        JSON.parse(item.data).forEach(itemEntree => {

                          this.articles.forEach(itemArticle => {
                            if (itemArticle.id === itemEntree.article.id) {
                              this.units.forEach(itemUnit => {
                                if (itemUnit.id === itemEntree.article.unit) {

                                  this.getDATA.push({name: itemEntree.article.name, quantity: itemEntree.quantity, unit: itemUnit.name})
                                }
                              })
                            }
                          })
                        })
                      }// end if alerts_entrees
                    })
                  },
                  closeViewEntree () {
                    this.dialogViewEntree = false
                    this.entreeDetail = {}
                  },
                },
                mounted: function () {

                },
                template: '#dashboard-template',
            });

            // article_vuejs : tous les produits
            Articles = Vue.component('articles', {
                delimiters: ['[[',']]'],

                data: () => ({
                  dialog: false,
                  dialogDelete: false,
                  dialogViewArticle: false,
                  error_message: '',
                  error_snackbar: false,
                  succes_produit_save_message: '',
                  succes_produit_save: false,
                  itemMax: 0,
                  headers: [
                    {
                      text: 'Article',
                      align: 'start',
                      sortable: true,
                      value: 'article',
                    },
                    // { text: 'Catégorie', value: 'category' },
                    { text: 'Stock', value: 'stock' },
                    { text: 'Unité Stock', value: 'unit' },
                    { text: 'Prix Achat', value: 'buying_price' },
                    { text: 'Prix Vente', value: 'selling_price' },
                    { text: 'TVA', value: 'tva' },
                    { text: 'Fournisseur', value: 'supplier' },
                    { text: 'Date', value: 'date' },
                    { text: 'Actions', value: 'actions', sortable: false },
                  ],
                  articles: [],
                  articleDetail: {},
                  produits: [],
                  suppliers: [],
                  units: [],
                  users: [],
                  search: '',
                  editedIndex: -1,
                  editedItem: {
                    article: '',
                    category: 'Produit',
                    buying_price: 0,
                    selling_price: 0,
                    tva: 0.18,
                    supplier: 1,
                    date: null,
                  },
                  defaultItem: {
                    article: '',
                    category: 'Produit',
                    buying_price: 0,
                    selling_price: 0,
                    tva: 0.18,
                    supplier: 1,
                    date: null,
                  },
              }),

              computed: {
                formTitle () {
                  return this.editedIndex === -1 ? 'Ajouter Produit' : 'Modifier Produit'
                },

                get_next_article_ean () {
                  this.articles.forEach(item => {
                    if (item.id > this.itemMax) {
                      this.itemMax = item.id
                    }
                  })
                  return 'ART' + ('000000000' + (this.itemMax + 1)).slice(-9)
                },
              },


              watch: {
                dialog (val) {
                  val || this.close()
                },
                dialogDelete (val) {
                  val || this.closeDelete()
                },
              },

              created () {
                this.initialize()
              },

              methods: {
                initialize () {
                  axios.get('http://127.0.0.1:8000/gstock/drf/produits-viewsets/')
                    .then(response => {
                      this.produits = response.data
                    })
                    .catch(error => {
                      if (error.message.includes("403") || error.message.includes("401")) {
                        this.error_message = "Accès refusé"
                      } else {
                        this.error_message = error.message
                      }

                      this.error_snackbar = true
                    })
                  axios.get('http://127.0.0.1:8000/gstock/drf/articles-viewsets/')
                    .then(response => {
                      this.articles = response.data
                    })
                    .catch(error => {
                      if (error.message.includes("403") || error.message.includes("401")) {
                        this.error_message = "Accès refusé"
                      } else {
                        this.error_message = error.message
                      }

                      this.error_snackbar = true
                    })
                  axios.get('http://127.0.0.1:8000/gstock/drf/suppliers-viewsets/')
                    .then(response => {
                      this.suppliers = response.data
                    })
                    .catch(error => {
                      if (error.message.includes("403") || error.message.includes("401")) {
                        this.error_message = "Accès refusé"
                      } else {
                        this.error_message = error.message
                      }

                      this.error_snackbar = true
                    })
                  axios.get('http://127.0.0.1:8000/gstock/drf/articles/unit/')
                    .then(response => {
                      this.units = response.data
                      this.units.sort(function (a, b) {
                        return a.id - b.id
                      })
                    })
                    .catch(error => {
                      if (error.message.includes("403") || error.message.includes("401")) {
                        this.error_message = "Accès refusé"
                      } else {
                        this.error_message = error.message
                      }

                      this.error_snackbar = true
                    })
                  axios.get('http://127.0.0.1:8000/gstock/drf/users-viewsets/')
                    .then(response => {
                      this.emprunteurs = response.data
                      this.users = response.data
                    })
                    .catch(error => {
                      if (error.message.includes("403") || error.message.includes("401")) {
                        this.error_message = "Accès refusé"
                      } else {
                        this.error_message = error.message
                      }

                      this.error_snackbar = true
                    })
                },

                getColor (stock, threshold) {
                  if (stock < threshold) return 'red'
                  else if (stock === threshold) return 'orange'
                  else return 'green'
                },

                addProduit (produitItem) {
                  axios.post('http://127.0.0.1:8000/gstock/drf/produits-viewsets/', produitItem)
                    .then(response => {
                      this.succes_produit_save_message = "'" + this.articles.find(article => article.id === produitItem.article).name + "'" + ' ajouté avec succès...'
                      this.succes_produit_save = true
                      this.initialize()

                      this.editedItem = Object.assign({}, this.defaultItem)
                    })
                    .catch(error => {
                      if (error.message.includes("403") || error.message.includes("401")) {
                        this.error_message = "Accès refusé"
                      } else {
                        this.error_message = error.message
                      }

                      this.error_snackbar = true
                    })
                },

                updateProduit (produitItem) {
                  axios.put(`http://127.0.0.1:8000/gstock/drf/produits-viewsets/${produitItem.id}/`, produitItem)
                    .then(response => {
                      this.succes_produit_save_message = "'" + this.articles.find(article => article.id === produitItem.article).name + "'" + ' modifié avec succès...'
                      this.succes_produit_save = true
                      this.initialize()
                    })
                    .catch(error => {
                      if (error.message.includes("403") || error.message.includes("401")) {
                        this.error_message = "Accès refusé"
                      } else {
                        this.error_message = error.message
                      }

                      this.error_snackbar = true
                    })
                },

                deleteProduit (articleItem) {
                  axios.delete(`http://127.0.0.1:8000/gstock/drf/produits-viewsets/${articleItem.id}/`, articleItem)
                    .then(response => {
                      this.succes_produit_save_message = "'" + this.articles.find(article => article.id === articleItem.article).name + "'" + ' supprimé avec succès...'
                      this.succes_produit_save = true
                      this.initialize()
                    })
                    .catch(error => {
                      if (error.message.includes("403") || error.message.includes("401")) {
                        this.error_message = "Accès refusé"
                      } else {
                        this.error_message = error.message
                      }

                      this.error_snackbar = true
                    })
                },

                articleDetailView (idArticle) {
                  this.articles.forEach(item => {
                    if (item.id === idArticle) {
                      this.articleDetail = item
                    }
                  })
                },

                editProduitItem (item) {
                  this.editedIndex = item.id
                  this.editedItem = Object.assign({}, item)
                  this.dialog = true
                },

                deleteProduitItem (item) {
                  this.editedItem = Object.assign({}, item)

                  confirm('Confirmez la suppression') && this.deleteProduit(this.editedItem)
                },

                close () {
                  this.dialog = false
                  this.$nextTick(() => {
                    this.editedItem = Object.assign({}, this.defaultItem)
                    this.editedIndex = -1
                  })
                },

                closeViewArticle () {
                  this.dialogViewArticle = false
                  this.articleDetail = {}
                },

                closeDelete () {
                  this.dialogDelete = false
                  this.$nextTick(() => {
                    this.editedItem = Object.assign({}, this.defaultItem)
                    this.editedIndex = -1
                  })
                },

                save_produit () {
                  if (this.editedIndex === -1) {
                    this.editedItem.article = parseInt(this.editedItem.article)
                    this.editedItem.category = "Produit"
                    this.editedItem.tva = 0.18
                    this.editedItem.buying_price = parseFloat(this.editedItem.buying_price)
                    this.editedItem.selling_price = parseInt(this.editedItem.selling_price)

                    this.addProduit (this.editedItem)
                  } else {
                    this.updateProduit (this.editedItem)
                  }

                  this.close()
                },


              },
              template: '#articles-template',
            });


            // stocks_vuejs : tous les articles confondus
            Stocks = Vue.component('stocks', {
              delimiters: ['[[',']]'],

              data: () => ({
                dialog: false,
                dialogDelete: false,
                error_message: '',
                error_snackbar: false,
                succes_article_save_message: '',
                succes_article_save: false,
                itemMax: 0,
                headers: [
                  {
                    text: 'Nom',
                    align: 'start',
                    sortable: true,
                    value: 'name',
                  },
                  { text: 'Modèle', value: 'articleModel' },
                  { text: 'Référence', value: 'reference' },
                  { text: 'Stock', value: 'stock' },
                  { text: 'Unité Stock', value: 'unit' },
                  { text: 'Seuil Stock', value: 'threshold' },
                  { text: 'Proprietaire', value: 'proprietaire' },
                  { text: 'Position', value: 'position' },
                  { text: 'Description', value: 'description' },
                  { text: 'Date', value: 'date' },
                  { text: 'Actions', value: 'actions', sortable: false },
                ],
                articles: [],
                units: [],
                users: [],
                search: '',
                editedIndex: -1,
                editedItem: {
                  name: '',
                  articleModel: '',
                  reference: '',
                  ean: '',
                  stock: 0,
                  unit: 1,
                  threshold: 1,
                  proprietaire: '',
                  position: '',
                  description: '',
                  date: null,
                },
                defaultItem: {
                  name: '',
                  articleModel: '',
                  reference: '',
                  ean: '',
                  stock: 0,
                  unit: 1,
                  threshold: 1,
                  proprietaire: '',
                  position: '',
                  description: '',
                  date: null,
                },
              }),

              computed: {
                formTitle () {
                  return this.editedIndex === -1 ? 'Ajouter Article' : 'Modifier Article'
                },

                get_next_article_ean () {
                  this.articles.forEach(item => {
                    if (item.id > this.itemMax) {
                      this.itemMax = item.id
                    }
                  })
                  return 'ART' + ('000000000' + (this.itemMax + 1)).slice(-9)
                },
              },


              watch: {
                dialog (val) {
                  val || this.close()
                },
                dialogDelete (val) {
                  val || this.closeDelete()
                },
              },

              created () {
                this.initialize()
              },

              methods: {
                initialize () {
                  axios.get('http://127.0.0.1:8000/gstock/drf/articles-viewsets/')
                    .then(response => {
                      this.articles = response.data
                    })
                    .catch(error => {
                      if (error.message.includes("403") || error.message.includes("401")) {
                        this.error_message = "Accès refusé"
                      } else {
                        this.error_message = error.message
                      }

                      this.error_snackbar = true
                    })
                  axios.get('http://127.0.0.1:8000/gstock/drf/articles/unit/')
                    .then(response => {
                      this.units = response.data
                      this.units.sort(function (a, b) {
                        return a.id - b.id
                      })
                    })
                    .catch(error => {
                      if (error.message.includes("403") || error.message.includes("401")) {
                        this.error_message = "Accès refusé"
                      } else {
                        this.error_message = error.message
                      }

                      this.error_snackbar = true
                    })
                  axios.get('http://127.0.0.1:8000/gstock/drf/users-viewsets/')
                    .then(response => {
                      this.emprunteurs = response.data
                      this.users = response.data
                    })
                    .catch(error => {
                      if (error.message.includes("403") || error.message.includes("401")) {
                        this.error_message = "Accès refusé"
                      } else {
                        this.error_message = error.message
                      }

                      this.error_snackbar = true
                    })
                },

                getColor (stock, threshold) {
                  if (stock < threshold) return 'red'
                  else if (stock === threshold) return 'orange'
                  else return 'green'
                },

                addArticle (articleItem) {
                  axios.post('http://127.0.0.1:8000/gstock/drf/articles-viewsets/', articleItem)
                    .then(response => {
                      this.succes_article_save_message = "'" + articleItem.name + "'" + ' ajouté avec succès...'
                      this.succes_article_save = true
                      this.initialize()

                      this.editedItem = Object.assign({}, this.defaultItem)
                    })
                    .catch(error => {
                      if (error.message.includes("403") || error.message.includes("401")) {
                        this.error_message = "Accès refusé"
                      } else {
                        this.error_message = error.message
                      }

                      this.error_snackbar = true
                    })
                },

                updateArticle (articleItem) {
                  axios.put(`http://127.0.0.1:8000/gstock/drf/articles-viewsets/${articleItem.id}/`, articleItem)
                    .then(response => {
                      this.succes_article_save_message = "'" + articleItem.name + "'" + ' modifié avec succès...'
                      this.succes_article_save = true
                      this.initialize()
                    })
                    .catch(error => {
                      if (error.message.includes("403") || error.message.includes("401")) {
                        this.error_message = "Accès refusé"
                      } else {
                        this.error_message = error.message
                      }

                      this.error_snackbar = true
                    })
                },

                deleteArticle (articleItem) {
                  axios.delete(`http://127.0.0.1:8000/gstock/drf/articles-viewsets/${articleItem.id}/`, articleItem)
                    .then(response => {
                      this.succes_article_save_message = "'" + articleItem.name + "'" + ' supprimé avec succès...'
                      this.succes_article_save = true
                      this.initialize()
                    })
                    .catch(error => {
                      if (error.message.includes("403") || error.message.includes("401")) {
                        this.error_message = "Accès refusé"
                      } else {
                        this.error_message = error.message
                      }

                      this.error_snackbar = true
                    })
                },

                editArticleItem (item) {
                  this.editedIndex = item.id
                  this.editedItem = Object.assign({}, item)
                  this.dialog = true
                },

                deleteArticleItem (item) {
                  this.editedItem = Object.assign({}, item)

                  confirm('Confirmez la suppression') && this.deleteArticle(this.editedItem)
                  // this.editedItem = Object.assign({}, this.defaultItem)
                  // this.editedIndex = -1
                },

                close () {
                  this.dialog = false
                  this.$nextTick(() => {
                    this.editedItem = Object.assign({}, this.defaultItem)
                    this.editedIndex = -1
                  })
                },

                closeDelete () {
                  this.dialogDelete = false
                  this.$nextTick(() => {
                    this.editedItem = Object.assign({}, this.defaultItem)
                    this.editedIndex = -1
                  })
                },

                save_article () {
                  if (this.editedIndex === -1) {
                    this.editedItem.ean = this.get_next_article_ean
                    this.editedItem.unit = parseInt(this.editedItem.unit)

                    this.addArticle (this.editedItem)
                  } else {
                    this.updateArticle(this.editedItem)
                  }

                  this.close()
                },
              },
              template: '#stocks-template',
            });


            //materiel_vuejs
            Materiels = Vue.component('materiels', {
                delimiters: ['[[',']]'],

                data: () => ({
                  dialog: false,
                  dialogViewArticle: false,
                  dialogDelete: false,
                  error_message: '',
                  error_snackbar: false,
                  succes_materiel_save_message: '',
                  succes_materiel_save: false,
                  itemMax: 0,
                  headers: [
                    {
                      text: 'Article',
                      align: 'start',
                      sortable: true,
                      value: 'article',
                    },
                    { text: 'Stock', value: 'stock' },
                    { text: 'Unité Stock', value: 'unit' },
                    { text: 'Position', value: 'position' },
                    { text: 'Description', value: 'description' },
                    { text: 'Date', value: 'date' },
                    { text: 'Actions', value: 'actions', sortable: false },
                  ],
                  articles: [],
                  articleDetail: {},
                  materiels: [],
                  units: [],
                  users: [],
                  search: '',
                  editedIndex: -1,
                  editedItem: {
                    article: {},
                    category: '',
                    date: null,
                  },
                  defaultItem: {
                    article: {},
                    category: '',
                    date: null,
                  },
              }),

              computed: {
                formTitle () {
                  return this.editedIndex === -1 ? 'Ajouter Matériel' : 'Modifier Matériel'
                },
              },


              watch: {
                dialog (val) {
                  val || this.close()
                },
                dialogDelete (val) {
                  val || this.closeDelete()
                },
              },

              created () {
                this.initialize()
              },

              methods: {
                initialize () {
                  axios.get('http://127.0.0.1:8000/gstock/drf/materiels-viewsets/')
                    .then(response => {
                      this.materiels = response.data
                    })
                    .catch(error => {
                      if (error.message.includes("403") || error.message.includes("401")) {
                        this.error_message = "Accès refusé"
                      } else {
                        this.error_message = error.message
                      }

                      this.error_snackbar = true
                    })
                  axios.get('http://127.0.0.1:8000/gstock/drf/articles-viewsets/')
                    .then(response => {
                      this.articles = response.data
                    })
                    .catch(error => {
                      if (error.message.includes("403") || error.message.includes("401")) {
                        this.error_message = "Accès refusé"
                      } else {
                        this.error_message = error.message
                      }

                      this.error_snackbar = true
                    })
                  axios.get('http://127.0.0.1:8000/gstock/drf/articles/unit/')
                    .then(response => {
                      this.units = response.data
                      this.units.sort(function (a, b) {
                        return a.id - b.id
                      })
                    })
                    .catch(error => {
                      if (error.message.includes("403") || error.message.includes("401")) {
                        this.error_message = "Accès refusé"
                      } else {
                        this.error_message = error.message
                      }

                      this.error_snackbar = true
                    })
                  axios.get('http://127.0.0.1:8000/gstock/drf/users-viewsets/')
                    .then(response => {
                      this.emprunteurs = response.data
                      this.users = response.data
                    })
                    .catch(error => {
                      if (error.message.includes("403") || error.message.includes("401")) {
                        this.error_message = "Accès refusé"
                      } else {
                        this.error_message = error.message
                      }

                      this.error_snackbar = true
                    })
                },

                getColor (stock, threshold) {
                  if (stock < threshold) return 'red'
                  else if (stock === threshold) return 'orange'
                  else return 'green'
                },

                closeViewArticle () {
                  this.dialogViewArticle = false
                  this.articleDetail = {}
                },

                articleDetailView (idArticle) {
                  this.articles.forEach(item => {
                    if (item.id === idArticle) {
                      this.articleDetail = item
                    }
                  })
                },

                addMateriel (materielItem) {
                  axios.post('http://127.0.0.1:8000/gstock/drf/materiels-viewsets/', materielItem)
                    .then(response => {
                      this.succes_materiel_save_message = "'" + this.articles.find(article => article.id === materielItem.article).name + "'" + ' ajouté avec succès...'
                      this.succes_materiel_save = true
                      this.initialize()
                      this.editedItem = Object.assign({}, this.defaultItem)
                    })
                    .catch(error => {
                      if (error.message.includes("403") || error.message.includes("401")) {
                        this.error_message = "Accès refusé"
                      } else {
                        this.error_message = error.message
                      }

                      this.error_snackbar = true
                    })
                },

                updateMateriel (materielItem) {
                  axios.put(`http://127.0.0.1:8000/gstock/drf/materiels-viewsets/${materielItem.id}/`, materielItem)
                    .then(response => {
                      this.succes_materiel_save_message =  "'" + this.articles.find(article => article.id === materielItem.article).name + "'" + ' modifié avec succès...'
                      this.succes_materiel_save = true
                      this.initialize()
                    })
                    .catch(error => {
                      if (error.message.includes("403") || error.message.includes("401")) {
                        this.error_message = "Accès refusé"
                      } else {
                        this.error_message = error.message
                      }

                      this.error_snackbar = true
                    })
                },

                deleteMateriel (materielItem) {
                  axios.delete(`http://127.0.0.1:8000/gstock/drf/materiels-viewsets/${materielItem.id}/`, materielItem)
                    .then(response => {
                      this.succes_materiel_save_message =  this.articles.find(article => article.id === materielItem.article).name + ' supprimé avec succès...'
                      this.succes_materiel_save = true
                      this.initialize()
                    })
                    .catch(error => {
                      if (error.message.includes("403") || error.message.includes("401")) {
                        this.error_message = "Accès refusé"
                      } else {
                        this.error_message = error.message
                      }

                      this.error_snackbar = true
                    })
                },

                editMaterielItem (item) {
                  this.editedIndex = item.id
                  this.editedItem = Object.assign({}, item)
                  this.dialog = true
                },

                deleteMaterielItem (item) {
                  this.editedItem = Object.assign({}, item)

                  confirm('Confirmez la suppression') && this.deleteMateriel(this.editedItem)
                },

                close () {
                  this.dialog = false
                  this.$nextTick(() => {
                    this.editedItem = Object.assign({}, this.defaultItem)
                    this.editedIndex = -1
                  })
                },

                closeDelete () {
                  this.dialogDelete = false
                  this.$nextTick(() => {
                    this.editedItem = Object.assign({}, this.defaultItem)
                    this.editedIndex = -1
                  })
                },

                save_materiel () {
                  if (this.editedIndex === -1) {
                    this.editedItem.category = "Materiel"

                    this.addMateriel(this.editedItem)
                  } else {
                    this.updateMateriel(this.editedItem)
                  }

                  this.close()
                },
              },
              template: '#materiels-template',
            });



            //fournisseur_vuejs
            Fournisseurs = Vue.component('fournisseurs', {
                delimiters: ['[[',']]'],

                data: () => ({
                  dialog: false,
                  dialogViewFournisseur: false,
                  dialogDelete: false,
                  error_message: '',
                  error_snackbar: false,
                  itemMax: 0,
                  headers: [
                    {
                      text: 'Nom',
                      align: 'start',
                      sortable: true,
                      value: 'name',
                    },
                    { text: 'Numéro', value: 'phoneNumber' },
                    { text: 'Fax', value: 'fax' },
                    { text: 'E-mail', value: 'email' },
                    { text: 'Site Web', value: 'site_web' },
                    { text: 'Description', value: 'description' },
                    { text: 'Date', value: 'date' },
                    { text: 'Actions', value: 'actions', sortable: false },
                  ],
                  validation_email_fournisseur: false,
                  error_fournisseur_save: false,
                  error_fournisseur_message: '',
                  succes_fournisseur_save_message: '',
                  succes_fournisseur_save: false,
                  fournisseurs: [],
                  fournisseurDetail: {},
                  users: [],
                  search: '',
                  editedIndex: -1,
                  editedItem: {
                    name: '',
                    phoneNumber: '',
                    fax: '',
                    email: '',
                    site_web: '',
                    description: '',
                    date: null,
                  },
                  defaultItem: {
                    name: '',
                    phoneNumber: '',
                    fax: '',
                    email: '',
                    site_web: '',
                    description: '',
                    date: null,
                  },
              }),

              computed: {
                formTitle () {
                  return this.editedIndex === -1 ? 'Ajouter Fournisseur' : 'Modifier Fournisseur'
                },
              },


              watch: {
                dialog (val) {
                  val || this.close()
                },
                dialogDelete (val) {
                  val || this.closeDelete()
                },
              },

              created () {
                this.initialize()
              },

              methods: {
                initialize () {
                  axios.get('http://127.0.0.1:8000/gstock/drf/suppliers-viewsets/')
                    .then(response => {
                      this.fournisseurs = response.data
                    })
                    .catch(error => {
                      if (error.message.includes("403") || error.message.includes("401")) {
                        this.error_message = "Accès refusé"
                      } else {
                        this.error_message = error.message
                      }

                      this.error_snackbar = true
                    })
                  axios.get('http://127.0.0.1:8000/gstock/drf/users-viewsets/')
                    .then(response => {
                      this.emprunteurs = response.data
                      this.users = response.data
                    })
                    .catch(error => {
                      if (error.message.includes("403") || error.message.includes("401")) {
                        this.error_message = "Accès refusé"
                      } else {
                        this.error_message = error.message
                      }

                      this.error_snackbar = true
                    })
                },

                // getColor (stock, threshold) {
                //   if (stock < threshold) return 'red'
                //   else if (stock === threshold) return 'orange'
                //   else return 'green'
                // },

                closeViewFournisseur () {
                  this.dialogViewFournisseur = false
                  this.fournisseurDetail = {}
                },

                fournisseurDetailView (fournisseur) {
                  this.fournisseurs.forEach(item => {
                    if (item.id === fournisseur.id) {
                      this.fournisseurDetail = item
                    }
                  })
                },

                addFournisseur (fournisseurItem) {
                  axios.post('http://127.0.0.1:8000/gstock/drf/suppliers-viewsets/', fournisseurItem)
                    .then(response => {
                      this.succes_fournisseur_save_message = "'" + fournisseurItem.name + "'" + ' ajouté avec succès...'
                      this.succes_fournisseur_save = true
                      this.initialize()
                      this.editedItem = Object.assign({}, this.defaultItem)
                    })
                    .catch(error => {
                      if (error.message.includes("403") || error.message.includes("401")) {
                        this.error_message = "Accès refusé"
                      } else {
                        this.error_message = error.message
                        // this.error_message = "Mauvaise requête"
                      }

                      this.error_snackbar = true
                    })
                },

                updateFournisseur (fournisseurItem) {
                  axios.put(`http://127.0.0.1:8000/gstock/drf/suppliers-viewsets/${fournisseurItem.id}/`, fournisseurItem)
                    .then(response => {
                      this.succes_fournisseur_save_message = "'" + fournisseurItem.name + "'" + ' modifié avec succès...'
                      this.succes_fournisseur_save = true
                      this.initialize()
                    })
                    .catch(error => {
                      if (error.message.includes("403") || error.message.includes("401")) {
                        this.error_message = "Accès refusé"
                      } else {
                        this.error_message = error.message
                        // this.error_message = "Mauvaise requête"
                      }

                      this.error_snackbar = true
                    })
                },

                deleteFournisseur (fournisseurItem) {
                  axios.delete(`http://127.0.0.1:8000/gstock/drf/suppliers-viewsets/${fournisseurItem.id}/`, fournisseurItem)
                    .then(response => {
                      this.succes_fournisseur_save_message = "'" + fournisseurItem.name + "'" + ' suppirmé avec succès...'
                      this.succes_fournisseur_save = true
                      this.initialize()
                    })
                    .catch(error => {
                      if (error.message.includes("403") || error.message.includes("401")) {
                        this.error_message = "Accès refusé"
                      } else {
                        this.error_message = error.message
                      }

                      this.error_snackbar = true
                    })
                },

                editFournisseurItem (item) {
                  this.editedIndex = item.id
                  this.editedItem = Object.assign({}, item)
                  this.dialog = true
                },

                deleteFournisseurItem (item) {
                  this.editedItem = Object.assign({}, item)

                  confirm('Confirmez la suppression') && this.deleteFournisseur(this.editedItem)
                },

                close () {
                  this.dialog = false
                  this.$nextTick(() => {
                    this.editedItem = Object.assign({}, this.defaultItem)
                    this.editedIndex = -1
                  })
                },

                closeDelete () {
                  this.dialogDelete = false
                  this.$nextTick(() => {
                    this.editedItem = Object.assign({}, this.defaultItem)
                    this.editedIndex = -1
                  })
                },

                save_fournisseur () {
                  this.error_fournisseur_message = ''

                  if (this.editedItem.name === '') {
                      this.error_fournisseur_message = "Nom invalide... "
                      this.error_fournisseur_save = true
                  }
                  if (!this.editedItem.email.match(/^\w+@[a-zA-Z_]+?\.[a-zA-Z]{2,3}$/)) {
                      this.error_fournisseur_message += "Adresse mail invalide... "
                      this.error_fournisseur_save = true
                  }
                  if (isNaN(this.editedItem.phoneNumber) === true || this.editedItem.phoneNumber === '') {
                      this.error_fournisseur_message += "Contact invalide... "
                      this.error_fournisseur_save = true
                  }

                  if (this.editedIndex === -1) {
                    if (!this.error_fournisseur_save && !isNaN(this.editedItem.phoneNumber) && this.editedItem.name != '') {
                      this.addFournisseur(this.editedItem)
                    }
                  } else {
                    this.updateFournisseur(this.editedItem)
                  }

                  this.close()
                },
              },
              template: '#fournisseurs-template',
            });



            // sortie_vuejs
            Sorties = Vue.component('sorties', {
                delimiters: ['[[',']]'],

                data : function () {
                  return {
                    message: 'Empty message',
                    error: 'Empty error',
                    error_emprunteur: '',
                    error_emptyData: '',
                    error_nullQuantity: '',
                    error_insufficientStock: '',
                    error_message: '',
                    error_snackbar: false,
                    error_motif: '',
                    today: strDateTime,
                    username: '',
                    current_user: '{{ user.username }}',
                    sorties: [],
                    users: [],
                    emprunteurs: [],
                    emprunteur: '',
                    motif: '',
                    articles: [],
                    articles_for_update: [],
                    units: [],
                    unit: {},
                    article: null,
                    itemMax: 0,
                    items: [
                      { article: { id: 0, name: '', stock: 0 }, quantity: 0, observation:'' },
                    ],
                    EmptyData: false,
                    insufficientStock: false,
                    nullQuantity: false,
                    sortieItem: {
                      date: null,
                      reference: '',
                      gestionnaire: '',
                      demandeur: '',
                      data: null,
                      motif: '',
                    },
                    // Emprunteur
                    // editedEmprunteurIndex: -1,
                    editedEmprunteur: {
                      id: 0,
                      first_name: '',
                      last_name: '',
                      username: '',
                      phoneNumber: '',
                      email: '',
                    },
                    defaultEmprunteur: {
                      id: 0,
                      first_name: '',
                      last_name: '',
                      phoneNumber: '',
                      email: '',
                    },
                    dialog: false,
                    snackbar: false,
                    snackbarColor: null,
                    save_sortieAlert: '',
                    rules: {
                      required: value => !!value || 'Required.',
                      counter: value => value.length <= 20 || 'Max 20 characters',
                      quantity_error: value => !Number.isInteger(value) || 'Quantité erronée',
                      email: value => {
                        const pattern = /^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/
                        return pattern.test(value) || 'Invalid e-mail.'
                      },
                    },
                    // End Emprunteur

                    // Liste Sortie data
                    dialog: false,
                    dialogDelete: false,
                    headers: [
                      {
                        text: 'Référence',
                        align: 'start',
                        sortable: true,
                        value: 'reference',
                      },
                      { text: 'Articles', value: 'data' },
                      { text: 'Gestionnaire', value: 'gestionnaire' },
                      { text: 'Demandeur', value: 'demandeur' },
                      { text: 'Motif', value: 'motif' },
                      { text: 'Date', value: 'date' },
                    ],
                    search: '',
                    editedIndex: -1,
                  }
                },

                computed: {
                  getNextemprunteurID () {
                    this.itemMax = 0

                    this.emprunteurs.forEach(item => {
                      if (item.id > this.itemMax) {
                        this.itemMax = item.id
                      }
                    })
                    return this.itemMax + 1
                  },

                  get_next_sortie_ref () {
                    this.sorties.forEach(item => {
                      if (item.id > this.itemMax) {
                        this.itemMax = item.id
                      }
                    })
                    return 'SOR' + ('000000000' + (this.itemMax + 1)).slice(-9)
                  },
                }, // End computed

                watch: {
                  dialog (val) {
                    val || this.close()
                  },
                }, // end watch

                created: function () {
                    this.initialize()
                },

                methods: {
                  initialize () {
                    axios.get('http://127.0.0.1:8000/gstock/drf/sorties/get/global/sorties/')
                      .then(response => {
                        this.sorties = response.data
                      })
                      .catch(error => {
                        if (error.message.includes("403") || error.message.includes("401")) {
                          this.error_message = "Accès refusé"
                        } else {
                          this.error_message = error.message
                        }

                        this.error_snackbar = true
                      })
                    axios.get('http://127.0.0.1:8000/gstock/drf/articles-viewsets/')
                      .then(response => {
                        this.articles = response.data
                      })
                      .catch(error => {
                        if (error.message.includes("403") || error.message.includes("401")) {
                          this.error_message = "Accès refusé"
                        } else {
                          this.error_message = error.message
                        }

                        this.error_snackbar = true
                      })
                    axios.get('http://127.0.0.1:8000/gstock/drf/users-viewsets/')
                      .then(response => {
                        this.emprunteurs = response.data
                        this.users = response.data
                      })
                      .catch(error => {
                        if (error.message.includes("403") || error.message.includes("401")) {
                          this.error_message = "Accès refusé"
                        } else {
                          this.error_message = error.message
                        }

                        this.error_snackbar = true
                      })
                    axios.get('http://127.0.0.1:8000/gstock/drf/articles/unit/')
                      .then(response => {
                        this.units = response.data
                        this.units.sort(function (a, b) {
                          return a.id - b.id
                        })
                      })
                      .catch(error => {
                        if (error.message.includes("403") || error.message.includes("401")) {
                          this.error_message = "Accès refusé"
                        } else {
                          this.error_message = error.message
                        }

                        this.error_snackbar = true
                      })
                    axios.get('http://127.0.0.1:8000/gstock/drf/users-viewsets/currentuser/')
                      .then(response => {
                        this.current_user = response.data
                      })
                      .catch(error => {
                        if (error.message.includes("403") || error.message.includes("401")) {
                          this.error_message = "Accès refusé"
                        } else {
                          this.error_message = error.message
                        }

                        this.error_snackbar = true
                      })
                  },

                  addSortie (sortieItem) {
                    axios.post('http://127.0.0.1:8000/gstock/drf/sorties/get/global/sorties/', sortieItem)
                      .then(response => {
                        this.initialize()
                        // update related articles
                        this.articles_for_update.forEach((articleItem, index) => {
                          this.updateArticle(articleItem)
                        })

                        this.articles_for_update = []

                        this.message = 'Sortie "' + sortieItem.reference + '" enregistré avec succès.'

                        this.snackbar = true
                        this.snackbarColor = 'success'
                        this.items = [{ article: { id: 0, name: '', stock: 0 }, quantity: 0, observation: '' }]
                        this.emprunteur = ''
                        this.motif = ''
                      })
                      .catch(error => {
                        if (error.message.includes("403") || error.message.includes("401")) {
                          this.error = "Accès refusé"
                        } else {
                          this.error = 'Mauvaise requête, revoir les données !'
                        }

                        this.snackbar = true
                        this.snackbarColor = 'error'
                        // alert(error)
                      })
                  },

                  updateArticle (articleItem) {
                    axios.put(`http://127.0.0.1:8000/gstock/drf/articles-viewsets/${articleItem.id}/`, articleItem)
                      .then(response => {
                        this.initialize()

                        this.items = [{ article: { id: 0, name: '', stock: 0 }, quantity: 0, observation: '' }]
                        this.emprunteur = ''
                      })
                      .catch(error => {
                        if (error.message.includes("403") || error.message.includes("401")) {
                          this.error = "Accès refusé"
                        } else {
                          this.error = 'Mauvaise requête, revoir les données !'
                        }

                        this.snackbar = true
                        this.snackbarColor = 'error'
                        // alert(error)
                      })
                  },

                  addRow () {
                    this.items.push({ article: {id:0}, quantity: 0, observation: '' })
                  },

                  deleteRow (item) {
                    const index = this.items.indexOf(item)
                    confirm('Are you sure you want to delete row ?') && this.items.splice(index, 1)
                  },


                  save_sortie () {
                    if (this.emprunteur) {
                      this.sortieItem.demandeur = parseInt(this.emprunteur) // set demandeur
                      this.error_emprunteur = ''
                    } else {

                      this.error_emprunteur = "Sélectionner un emprunteur \n"
                    }

                    this.items.forEach((item, index) => {
                      if (item.article.id === 0) {
                        this.EmptyData = true
                      }
                      this.articles.forEach((articleItem, index) => {
                        if (articleItem.id === item.article.id) {
                          articleItem.stock = parseInt(articleItem.stock) - parseInt(item.quantity) // Mise à jour stock
                          this.articles_for_update.push(articleItem);// liste des articles à mettre à jour

                          if (item.quantity > articleItem.stock) {// controle sur la quantité et le stock

                            this.error_insufficientStock += 'Quantité insuffisante pour cet article : "' + articleItem.name + '"\n'
                            this.insufficientStock = true
                          } else {
                            // this.insufficientStock = false
                            // this.error_insufficientStock = this.error_insufficientStock.replace('Quantité insuffisante pour cet article : "' + articleItem.name + '"\n', "")
                          }
                          if (item.quantity <= 0 || typeof item.quantity === 'NaN') {
                            this.nullQuantity = true
                            // this.save_sortieAlert += '\n\n' + 'Quantité invalide; Renseigner la quantité de: "' + articleItem.name + '"'
                            this.error_nullQuantity += 'Quantité invalide; Renseigner la quantité de: "' + articleItem.name + '"\n'
                          }
                        }
                      })
                    })

                    if (this.EmptyData === false) {// Controle sur data (non vide)
                      this.sortieItem.data = JSON.stringify(this.items) // set data (conversion object en string)
                      this.error_emptyData = ''
                    } else {
                      this.EmptyData = false

                      this.error_emptyData = 'Il y\'a des lignes vides, Selectionner des articles ou supprimer les lignes vides\n'
                    }

                    this.sortieItem.reference = this.get_next_sortie_ref // set reference

                    if (this.motif) {// controle sur le motif
                      this.sortieItem.motif = this.motif // set motif
                      this.error_motif = ''
                    } else {
                      this.error_motif = 'Renseigner le motif de la Sortie de matériel\n'
                    }

                    this.users.forEach((user, index) => {
                      if (user.username === this.current_user.username) {
                        // alert("User ID : " + user.id)
                        this.sortieItem.gestionnaire = user.id // set gestionnaire
                      }
                    })

                    // alert(this.EmptyData  )
                    // alert(this.insufficientStock )
                    // alert(this.EmptyData)
                    // alert(this.nullQuantity)
                    // this.insufficientStock  + this.EmptyData + this.nullQuantity
                    if (this.insufficientStock === false && this.EmptyData === false && this.nullQuantity === false && this.emprunteur && this.motif) {
                      this.addSortie(this.sortieItem)
                      this.error = 'Empty error'
                    } else {
                      this.insufficientStock = false
                      this.EmptyData = false
                      this.nullQuantity = false
                      this.snackbar = true
                      this.snackbarColor = 'error'
                      this.error = this.error_emprunteur + this.error_emptyData + this.error_insufficientStock + this.error_nullQuantity + this.error_motif
                      this.error_emprunteur = ''
                      this.error_emptyData = ''
                      this.error_insufficientStock = ''
                      this.error_nullQuantity = ''
                      this.error_motif = ''
                      this.message = 'Empty message'
                      this.articles_for_update = []
                      // alert(this.save_sortieAlert)
                      this.save_sortieAlert = ''
                      this.initialize()
                    }
                  },
                  // Emprunteur Management
                  closeEmprunteur () {
                    this.dialog = false
                    this.$nextTick(() => {
                      this.editedEmprunteur = Object.assign({}, this.defaultEmprunteur)
                    })
                  },

                  addEmprunteur (emprunteurItem) {
                    axios.post('http://127.0.0.1:8000/gstock/add-emprunteur/', emprunteurItem)
                      .then(response => {
                        this.initialize()
                        this.message = 'The emprunteur "' + emprunteurItem.first_name + ' ' + emprunteurItem.last_name + '" has been successfully saved.'
                        this.editedEmprunteur = this.defaultEmprunteur
                        this.snackbar = true
                        this.snackbarColor = 'success'
                      })
                      .catch(error => {
                        this.error = 'Bad request, kindly review informations entered !'
                        this.snackbar = true
                        this.snackbarColor = 'error'
                        // alert(error)
                      })
                  },
                  saveEmprunteur () {
                    this.addEmprunteur(this.editedEmprunteur)
                    this.closeEmprunteur()
                  },

                },
                template: '#sorties-template',
            });


            // entree_vuejs
            Entrees = Vue.component('entrees', {
                delimiters: ['[[',']]'],
                filters: {
                  currency (value) {
                    // return value.toFixed(2)
                    return fcfa.format(value)
                  },
                },
                data : function () {
                  return {
                    message: 'Empty message',
                    error: 'Empty error',
                    error_emprunteur: '',
                    error_emptyData: '',
                    error_nullQuantity: '',
                    error_message: '',
                    error_snackbar: false,
                    today: strDateTime,
                    username: '',
                    current_user: '{{ user.username }}',
                    entrees: [],
                    users: [],
                    emprunteurs: [],
                    emprunteur: '',
                    articles: [],
                    articles_for_update: [],
                    units: [],
                    unit: {},
                    article: null,
                    itemMax: 0,
                    items: [
                      { article: { id: 0, name: '', stock: 0 }, quantity: 0, observation:'' },
                    ],
                    EmptyData: false,
                    insufficientStock: false,
                    nullQuantity: false,
                    entreeItem: {
                      date: null,
                      reference: '',
                      gestionnaire: '',
                      demandeur: '',
                      data: null,
                    },
                    // Emprunteur
                    // editedEmprunteurIndex: -1,
                    editedEmprunteur: {
                      id: 0,
                      first_name: '',
                      last_name: '',
                      username: '',
                      phoneNumber: '',
                      email: '',
                    },
                    defaultEmprunteur: {
                      id: 0,
                      first_name: '',
                      last_name: '',
                      phoneNumber: '',
                      email: '',
                    },
                    dialog: false,
                    snackbar: false,
                    snackbarColor: null,
                    save_entreeAlert: '',
                    rules: {
                      required: value => !!value || 'Required.',
                      counter: value => value.length <= 20 || 'Max 20 characters',
                      number: value => typeof value === 'number' || 'Quantité invalide',
                      email: value => {
                        const pattern = /^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/
                        return pattern.test(value) || 'Invalid e-mail.'
                      },
                    },
                    // End Emprunteur

                    // Liste entrees data
                    dialog: false,
                    dialogDelete: false,
                    headers: [
                      {
                        text: 'Référence',
                        align: 'start',
                        sortable: true,
                        value: 'reference',
                      },
                      { text: 'Articles', value: 'data' },
                      { text: 'Gestionnaire', value: 'gestionnaire' },
                      { text: 'Demandeur', value: 'demandeur' },
                      { text: 'Date', value: 'date' },
                    ],
                    search: '',
                    editedIndex: -1,
                  }
                },
                computed: {
                  getNextemprunteurID () {
                    this.itemMax = 0

                    this.emprunteurs.forEach(item => {
                      if (item.id > this.itemMax) {
                        this.itemMax = item.id
                      }
                    })
                    return this.itemMax + 1
                  },

                  get_next_entry_ref () {
                    this.entrees.forEach(item => {
                      if (item.id > this.itemMax) {
                        this.itemMax = item.id
                      }
                    })
                    return 'ENT' + ('000000000' + (this.itemMax + 1)).slice(-9)
                  },
                }, // End computed

                watch: {
                  // dialog (val) {
                  //   val || this.close()
                  // },
                }, // end watch

                created: function () {
                    this.initialize()
                },

                methods: {
                  initialize () {
                    axios.get('http://127.0.0.1:8000/gstock/drf/entrees/get/global/entrees/')
                      .then(response => {
                        this.entrees = response.data
                      })
                      .catch(error => {
                        if (error.message.includes("403") || error.message.includes("401")) {
                          this.error_message = "Accès refusé"
                        } else {
                          this.error_message = error.message
                        }

                        this.error_snackbar = true
                      })
                    axios.get('http://127.0.0.1:8000/gstock/drf/articles-viewsets/')
                      .then(response => {
                        this.articles = response.data
                      })
                      .catch(error => {
                        if (error.message.includes("403") || error.message.includes("401")) {
                          this.error_message = "Accès refusé"
                        } else {
                          this.error_message = error.message
                        }

                        this.error_snackbar = true
                      })
                    axios.get('http://127.0.0.1:8000/gstock/drf/users-viewsets/')
                      .then(response => {
                        this.emprunteurs = response.data
                        this.users = response.data
                      })
                      .catch(error => {
                        if (error.message.includes("403") || error.message.includes("401")) {
                          this.error_message = "Accès refusé"
                        } else {
                          this.error_message = error.message
                        }

                        this.error_snackbar = true
                      })
                    axios.get('http://127.0.0.1:8000/gstock/drf/articles/unit/')
                      .then(response => {
                        this.units = response.data
                        this.units.sort(function (a, b) {
                          return a.id - b.id
                        })
                      })
                      .catch(error => {
                        if (error.message.includes("403") || error.message.includes("401")) {
                          this.error_message = "Accès refusé"
                        } else {
                          this.error_message = error.message
                        }

                        this.error_snackbar = true
                      })
                    axios.get('http://127.0.0.1:8000/gstock/drf/users-viewsets/currentuser/')
                      .then(response => {
                        this.current_user = response.data
                      })
                      .catch(error => {
                        if (error.message.includes("403") || error.message.includes("401")) {
                          this.error_message = "Accès refusé"
                        } else {
                          this.error_message = error.message
                        }

                        this.error_snackbar = true
                      })
                  },

                  addEntree (entreeItem) {
                    axios.post('http://127.0.0.1:8000/gstock/drf/entrees/get/global/entrees/', entreeItem)
                      .then(response => {
                        this.initialize()
                        // update related articles
                        this.articles_for_update.forEach((articleItem, index) => {
                          this.updateArticle(articleItem)
                        })

                        this.articles_for_update = []

                        this.message = 'Entrée "' + entreeItem.reference + '" enregistré avec succès.'
                        this.snackbar = true
                        this.snackbarColor = 'success'
                        this.items = [{ article: { id: 0, name: '', stock: 0 }, quantity: 0, observation: '' }]
                        this.emprunteur = ''
                      })
                      .catch(error => {
                        if (error.message.includes("403") || error.message.includes("401")) {
                          this.error = "Accès refusé"
                        } else {
                          this.error = 'Mauvaise requête, revoir les données !'
                        }

                        this.snackbar = true
                        this.snackbarColor = 'error'
                        // alert(error)
                      })
                  },

                  updateArticle (articleItem) {
                    axios.put(`http://127.0.0.1:8000/gstock/drf/articles-viewsets/${articleItem.id}/`, articleItem)
                      .then(response => {
                        this.initialize()
                        // this.message = 'L\'article "' + articleItem.name + '" modifié avec succès.'
                        // this.snackbar = true
                        // this.snackbarColor = 'success'
                      })
                      .catch(error => {
                        if (error.message.includes("403") || error.message.includes("401")) {
                          this.error = "Accès refusé"
                        } else {
                          this.error = 'Mauvaise requête, revoir les données !'
                        }

                        this.snackbar = true
                        this.snackbarColor = 'error'
                        // alert(error)
                      })
                  },

                  addRow () {
                    this.items.push({ article: {id:0}, quantity: 0, observation: '' })
                  },

                  deleteRow (item) {
                    const index = this.items.indexOf(item)
                    confirm('Are you sure you want to delete row ?') && this.items.splice(index, 1)
                  },


                  save_entree () {
                    // entreeItem.demandeur
                    if (this.emprunteur) {
                      this.entreeItem.demandeur = parseInt(this.emprunteur) // set demandeur
                      this.error_emprunteur = ''
                    } else {
                      // this.save_entreeAlert += '\n\n' + 'Sélectionner un emprunteur'
                      this.error_emprunteur = 'Sélectionner un emprunteur\n'
                    }
                    // entreeItem.data
                    this.items.forEach((item, index) => {
                      if (item.article.id === 0) {
                        this.EmptyData = true
                      }
                      // alert(this.EmptyData + ' - ' + item.article.id)
                      this.articles.forEach((articleItem, index) => {
                        if (articleItem.id === item.article.id) {
                          articleItem.stock = parseInt(articleItem.stock) + parseInt(item.quantity) // Mise à jour stock
                          this.articles_for_update.push(articleItem);// liste des articles à mettre à jour
                          // this.error_nullQuantity += index + '\n'

                          if (item.quantity <= 0 || typeof item.quantity === 'NaN') {
                            this.nullQuantity = true
                            // this.save_entreeAlert += '\n\n' + 'Quantité invalide; Renseigner la quantité de: "' + articleItem.name + '"'
                            this.error_nullQuantity += 'Quantité invalide; Renseigner la quantité de: "' + articleItem.name + '"\n'
                          }
                        }
                      })
                    })

                    if (this.EmptyData === false) {// Controle sur data (non vide)
                      this.entreeItem.data = JSON.stringify(this.items) // set data (conversion object en string)
                      this.error_emptyData = ''
                    } else {
                      // this.save_entreeAlert += '\n\n' + 'Il y\'a des lignes vides, Selectionner des articles ou supprimer les lignes vides'
                      this.error_emptyData = 'Il y\'a des lignes vides, Selectionner des articles ou supprimer les lignes vides\n'
                    }

                    this.entreeItem.reference = this.get_next_entry_ref // set reference

                    this.users.forEach((user, index) => {
                      if (user.username === this.current_user.username) {
                        // alert("User ID : " + user.id)
                        this.entreeItem.gestionnaire = user.id // set gestionnaire
                      }
                    })

                    // alert('Emprunteur: ' + this.entreeItem.demandeur)
                    // alert('Gestionnaire: ' + typeof this.entreeItem.gestionnaire)
                    // alert('Ref: ' + this.entreeItem.reference)
                    // alert('Data : ' + this.entreeItem.data)
                    if (this.EmptyData === false && this.nullQuantity === false && this.emprunteur) {
                      this.addEntree(this.entreeItem)
                      this.error = 'Empty error'
                    } else {
                      this.EmptyData = false
                      this.nullQuantity = false
                      this.error = this.error_emprunteur + this.error_emptyData + this.error_nullQuantity
                      this.error_emprunteur = ''
                      this.error_emptyData = ''
                      this.error_nullQuantity = ''
                      this.snackbar = true
                      this.snackbarColor = 'error'
                      this.message = 'Empty message'
                      // alert(this.save_entreeAlert)
                      // this.save_entreeAlert = ''
                      this.articles_for_update = []
                      this.initialize()
                    }
                  },

                  // Emprunteur Management
                  // closeEmprunteur () {
                  //   this.dialog = false
                  //   this.$nextTick(() => {
                  //     this.editedEmprunteur = Object.assign({}, this.defaultEmprunteur)
                  //   })
                  // },
                  //
                  // addEmprunteur (emprunteurItem) {
                  //   axios.post('http://127.0.0.1:8000/gstock/add-emprunteur/', emprunteurItem)
                  //     .then(response => {
                  //       this.initialize()
                  //       this.message = 'The emprunteur "' + emprunteurItem.first_name + ' ' + emprunteurItem.last_name + '" has been successfully saved.'
                  //       this.editedEmprunteur = this.defaultEmprunteur
                  //       this.snackbar = true
                  //       this.snackbarColor = 'success'
                  //     })
                  //     .catch(error => {
                  //       this.error = 'Bad request, kindly review informations entered !'
                  //       this.snackbar = true
                  //       this.snackbarColor = 'error'
                  //       // console.log(error)
                  //       alert(error)
                  //       // setTimeout(() => { window.location.reload() }, 3000)
                  //     })
                  // },
                  // saveEmprunteur () {
                  //   this.addEmprunteur(this.editedEmprunteur)
                  //   this.closeEmprunteur()
                  // },
                },
                template: '#entrees-template',
            });

            Login = Vue.component('gstock-login', {
                template: '#gstock-login-template',
            });

            Logout = Vue.component('gstock-logout', {
                template: '#gstock-logout-template',
            });

            NotFound = Vue.component('gstock-notfound', {
                template: '#gstock-notfound-template',
            });

            Empty = Vue.component('gstock-empty', {
                template: '#gstock-empty-template',
            });
            // End components

            // const username = '';

            // store
            Vue.use(Vuex)
            const getDefaultState = () => {
              return {
                token: null,
                user: {},
                current_username: {},
              }
            }

            const store = new Vuex.Store({
              plugins: [createPersistedState()],
              state: {
                user: {},
                token: null,
                current_username: {},
              },
              getters: {
                // Below for login/logout/

                isLoggedIn: state => {
                  return state.token
                },
                getUser: state => {
                  return state.user
                },
                getCurrentUsername: state => {
                  return state.current_username
                },
                loggedIn (state) {
                  return state.token != null
                }
              },
              mutations: {
                // Below for login/logout/

                SET_TOKEN: (state, token) => {
                  state.token = token
                },
                SET_USER: (state, user) => {
                  state.user = user
                },
                SET_CURRENT_USERNAME: (state, current_username) => {
                  state.current_username = current_username
                },
                RESET: state => {
                  Object.assign(state, getDefaultState())
                },
              },
              actions: {
                // Below for login/logout/

                login: ({ commit, dispatch }, { token, user, current_username, }) => {
                  commit('SET_TOKEN', token)
                  commit('SET_USER', user)
                  commit('SET_CURRENT_USERNAME', current_username)

                  // set auth header
                  axios.defaults.headers.common.Authorization = ` Token ${token}`
                },
                logout: ({ commit }) => {
                  commit('RESET', '')
                },
              }
            });
            // End store

            // router
            Vue.use(VueRouter)
            const routes = [
                { component: Dashboard, path: '/gstock/', name: 'dashboard_1', meta: {requiresAuth: true}, },
                { component: Dashboard, path: '/gstock/dashboard/', name: 'dashboard', meta: {requiresAuth: true}, },//Vue.$app_stat_base.data.current_username//$store.getters.isLoggedIn
                { component: Articles, path: '/gstock/produits/', name: 'produits', meta: {requiresAuth: true}, },// Article component is for Produit
                { component: Materiels,  path: '/gstock/materiels/', name: 'materiels', meta: {requiresAuth: true}, },
                { component: Stocks,  path: '/gstock/stocks/', name: 'stocks', meta: {requiresAuth: true}, },
                { component: Fournisseurs,  path: '/gstock/fournisseurs/', name: 'fournisseurs', meta: {requiresAuth: true}, },
                { component: Sorties,  path: '/gstock/sorties/', name: 'sorties', meta: {requiresAuth: true}, },
                { component: Entrees,  path: '/gstock/entrees/', name: 'entrees', meta: {requiresAuth: true}, },

                { component: Login,  path: '/gstock/login/', name: 'login', meta: {requiresLogged: true}, },
                { component: Logout,  path: '/gstock/logout/', name: 'logout', meta: {requiresAuth: true}, },

                { component: NotFound, path: '/gstock/*', },
            ];

            const router = new VueRouter({
                mode: 'history',
                routes: routes,
            });

            router.beforeEach((to, from, next) => {
            // if any of the routes in routes has a meta named 'requiresAuth: true'
            // then check if the user is logged in before routing to this path:
            if (to.matched.some(record => record.meta.requiresAuth)) {
              if (!store.getters.loggedIn) {
                next({ name: 'login' })
              } else {
                next()
              }
            } else if (to.matched.some(record => record.meta.requiresLogged)) {
              // else if any of the routes in routes has a meta named 'requiresLogged: true'
              // then check if the user is logged in; if true continue to home page else continue routing to the destination path
              // this comes to play if the user is logged in and tries to access the login/register page
              if (store.getters.loggedIn) {
                next({ name: 'dashboard' })
              } else {
                next()
              }
            } else {
              next()
            }
          })
            // End router

            ///axios
            Vue.use(axios);
            // axios.defaults.baseURL = 'http://127.0.0.1:8000/gstock';
            // axios.defaults.xsrfCookieName = 'csrftoken'
            // axios.defaults.xsrfHeaderName = 'X-CSRFTOKEN'
            // axios.defaults.headers.common['Authorization'] = AUTH_TOKEN;
            // axios.defaults.headers.post['Content-Type'] = 'application/x-www-form-urlencoded';

            // App Base
            const app_stat_base = new Vue({
                el: '#app',
                vuetify: new Vuetify(),
                store,
                router,

                delimiters: ['[[',']]'],

                data: {
                    drawer: null,
                    selectedItem: 0,
                    fab: false,
                    current_username: '{{ user.username }}',
                    app_base_url: "{% url 'index_gstock' %}",
                    isLogged: false,
                    username: '',
                    password: '',
                    wrongCred: false, // activates appropriate message if set to true
                    response: '',
                    msg: '',
                    // perm_article_delete: '{{ perms.auth.delete_article }}',
                    items: [
                        {
                            text: "Dashboard",
                            disabled: false,
                            href: "/gstock/dashboard/",
                            icon: "mdi-view-dashboard"
                        },
                        {
                            text: "Produits",
                            disabled: false,
                            href: "/gstock/produits/",
                            icon: "mdi-shopping"
                        },
                        {
                            text: "Materiels",
                            disabled: false,
                            href: "/gstock/materiels/",
                            icon: "mdi-store"
                        },
                        {
                            text: "Stock Global",
                            disabled: false,
                            href: "/gstock/stocks/",
                            icon: "mdi-store"
                        },
                        {
                            text: "Fournisseurs",
                            disabled: false,
                            href: "/gstock/fournisseurs/",
                            icon: "mdi-cart"
                        },
                        {
                            text: "Entées",
                            disabled: false,
                            href: "/gstock/entrees/",
                            icon: "mdi-location-enter"
                        },
                        {
                            text: "Sorties",
                            disabled: false,
                            href: "/gstock/sorties/",
                            icon: "mdi-location-exit"
                        },
                    ],
                    trees : [
                        [
                            {
                                text: "Dashboard",
                                disabled: true,
                                href: "/gstock/dashboard/",
                            },
                        ],
                        [
                            {
                                text: "Dashboard",
                                disabled: false,
                                href: "/gstock/dashboard/",
                            },
                            {
                                text: "Produits",
                                disabled: true,
                                href: "/gstock/produits/",
                            },
                        ],
                        [
                            {
                                text: "Dashboard",
                                disabled: false,
                                href: "/gstock/dashboard/",
                            },
                            {
                                text: "Materiels",
                                disabled: true,
                                href: "/gstock/materiels/",
                            },
                        ],
                        [
                            {
                                text: "Dashboard",
                                disabled: false,
                                href: "/gstock/dashboard/",
                            },
                            {
                                text: "Stocks",
                                disabled: true,
                                href: "/gstock/stocks/",
                            },
                        ],
                        [
                            {
                                text: "Dashboard",
                                disabled: false,
                                href: "/gstock/dashboard/",
                            },
                            {
                                text: "Fournisseurs",
                                disabled: true,
                                href: "/gstock/fournisseurs/",
                            },
                        ],
                        [
                            {
                                text: "Dashboard",
                                disabled: false,
                                href: "/gstock/dashboard/",
                            },
                            {
                                text: "Entrées",
                                disabled: true,
                                href: "/gstock/entrees/",
                            },
                        ],
                        [
                            {
                                text: "Dashboard",
                                disabled: false,
                                href: "/gstock/dashboard/",
                            },
                            {
                                text: "Sorties",
                                disabled: true,
                                href: "/gstock/sorties/",
                            },
                        ],
                    ]
                },

                watch: {
                  // whenever perm_article_delete changes, this function will run
                  // perm_article_delete: function () {
                  //   this.perm_article_delete = '{{ perms.auth.delete_article }}'
                  // }
                },

                created: function () {
                  if (this.$store.getters.isLoggedIn != null) {
                    this.isLogged = true
                    this.current_username  = this.$store.getters.getCurrentUsername

                    // set auth header
                    axios.defaults.headers.common.Authorization = ` Token ${this.$store.state.token}`
                  }
                },

                methods: {
                    onScroll (e) {
                        if (typeof window === 'undefined') return

                        const top = window.pageYOffset ||   e.target.scrollTop || 0
                        this.fab = top > 20
                    },

                    toTop () {
                        this.$vuetify.goTo(0)
                    },

                    // Authentication service
                    authService (credentials) {// response.data contient : token, userID, userEmail
                      return axios.post('http://127.0.0.1:8000/api-token-auth/', credentials)
                        .then(response => response.data)
                        .catch(error => { alert(error) })
                    },

                    //Login
                    async loginUser () { // call loginUSer action
                      try {
                        this.credentials = {
                          username: this.username,
                          password: this.password,
                        }
                        // alert(this.credentials.username + '|' + this.credentials.password)
                        this.response = await this.authService(this.credentials)
                        if (this.response.token != null) {
                          const token = this.response.token
                          const user = this.response.user
                          const current_username = this.response.current_username
                          this.current_username = this.response.current_username // assign current_username

                          this.$store.dispatch('login', { token, user, current_username, }).then(() => {
                            this.isLogged = true
                            this.$router.push({ name: 'dashboard' })
                          })
                        }
                      } catch (error) {
                        console.log(error)
                      }
                    },

                    logout () {
                      this.$store.dispatch('logout').then(() => {
                        this.isLogged = false
                        this.$router.push({ name: 'login' })
                      }).catch ((error) =>  {
                        console.log(error)
                      })
                    },
                },
            });
            // End App Base

            function date_time(id_date, id_time) {
                date = new Date;
                year = date.getFullYear();

                month = date.getMonth();
                //months = new Array('Janvier', 'Février', 'Mars', 'Avril', 'Mai', 'Juin', 'Juillet', 'Août', 'Septembre', 'Octobre', 'Novembre', 'Décembre');
                months = new Array('Jan', 'Fev', 'Mar', 'Avr', 'Mai', 'Jun', 'Jul', 'Aou', 'Sep', 'Oct', 'Nov', 'Dec');

                d = date.getDate();
                day = date.getDay();
                days = new Array('Dim', 'Lun', 'Mar', 'Mer', 'Jeu', 'Ven', 'Sam');
                //days = new Array('Dimanche', 'Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi', 'Samedi');

                h = date.getHours();
                if(h<10)
                {
                        h = "0"+h;
                }
                m = date.getMinutes();
                if(m<10)
                {
                        m = "0"+m;
                }
                s = date.getSeconds();
                if(s<10)
                {
                        s = "0"+s;
                }

                date = ''+days[day]+' '+d+' '+months[month]+' '+year;
                time = h+':'+m+':'+s;

                document.getElementById(id_date).innerHTML = date;
                document.getElementById(id_time).innerHTML = time;

                setTimeout('date_time("' + id_date +'" , "'+ id_time + '");','1000');

                return true;
            }
        </script>
        <!-- End Vue app -->
    </body>
</html>
